<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>â€œURL Schemeâ€ in iOS æµ…æ</title>
      <link href="/%E2%80%9CURL-Scheme%E2%80%9D-in-iOS-%E6%B5%85%E6%9E%90.html"/>
      <url>/%E2%80%9CURL-Scheme%E2%80%9D-in-iOS-%E6%B5%85%E6%9E%90.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>åšä¸€ä¸ªåå¤æ¨ªè·³çš„é­”æ³•å¸ˆğŸ§™â€â™€ï¸</p></blockquote><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯URL-Scheme"><a href="#ä»€ä¹ˆæ˜¯URL-Scheme" class="headerlink" title="ä»€ä¹ˆæ˜¯URL Scheme"></a>ä»€ä¹ˆæ˜¯URL Scheme</h2><p>åœ¨è‹¹æœçš„ç”Ÿæ€ä¸­ï¼Œå­˜åœ¨æ²™ç›’æœºåˆ¶æ¥ä¿éšœç”¨æˆ·çš„éšç§å’Œappé—´çš„ä¿¡æ¯å®‰å…¨ã€‚ä½†æ˜¯åº”ç”¨ä¹‹é—´ä¸å¯èƒ½æ¯«æ— æ•°æ®äº¤æµå’Œä¸šåŠ¡è·³è½¬ï¼Œå› æ­¤<code>URL Scheme</code>å°±æ˜¯æ‰“ç ´è¿™å±‚éš”è†œçš„å·¥å…·ã€‚é€šè¿‡<code>URL Scheme</code>ï¼Œappå¯ä»¥è·³è½¬æˆ–è€…å”¤èµ·å¦ä¸€ä¸ªappï¼Œæ‹‰èµ·åˆ†äº«ï¼Œæ”¯ä»˜ç­‰ä¸šåŠ¡åŠŸèƒ½ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç»™è‡ªå·±çš„appå®šåˆ¶ä¸€ä¸ªä¸“å±<code>URL Scheme</code>è®©åˆ«çš„appå’Œä½ è¿›è¡Œäº’åŠ¨ã€‚</p><h2 id="URL-Scheme-æµ…æ"><a href="#URL-Scheme-æµ…æ" class="headerlink" title="URL Scheme æµ…æ"></a>URL Scheme æµ…æ</h2><p><code>URL</code>ï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼›<code>URL</code>åœ°å€æ ¼å¼æ’åˆ—ä¸ºï¼š<code>scheme://host:port/path</code> ã€‚</p><p>ç±»ä¼¼çš„ï¼Œä¸€ä¸ª URL Schemes åˆ†ä¸º Schemeã€Actionã€Parameterã€Value è¿™ 4 ä¸ªéƒ¨åˆ†ï¼Œä¸­é—´ç”¨å†’å· <code>:</code>ã€æ–œçº¿ <code>/</code>ã€é—®å· <code>?</code>ã€ç­‰å· <code>=</code> ç›¸è¿æ¥ã€‚</p><p>Schemeè¿™ä¸ªä¸œè¥¿åœ¨ URL é‡Œæœ¬æ¥ç”¨æ¥è¡¨ç¤ºåè®®ï¼Œæ¯”å¦‚ <code>http</code>ã€<code>https</code>ã€<code>ftp</code> ç­‰ã€‚ä½†æ˜¯ï¼Œåœ¨ iOS çš„è¿™äº› URL é‡Œå®ƒä»¬å°±ä¸æ˜¯åè®®äº†ï¼Œè€Œæ˜¯<strong>å¯åŠ¨ä¸€ä¸ªåº”ç”¨çš„ URL</strong>ã€‚</p><p>é“¾æ¥å¤´å’Œæ–œçº¿ä¹‹åï¼Œè·Ÿçš„æ˜¯åŠ¨ä½œï¼ˆActionï¼‰ã€‚åŠ¨ä½œåœ¨ä¸€äº›æ–‡æ¡£é‡Œä¹Ÿè¢«ç§°ä¸ºã€ŒCommandï¼ˆå‘½ä»¤ï¼‰ã€ã€‚</p><p>åœ¨åŠ¨ä½œä¹‹åå¯ä»¥æ¥å‚æ•°ï¼ˆParameterï¼‰ä¹Ÿå¯ä»¥ä¸æ¥ï¼Œã€Œå‚æ•°ä»¥é—®å· <code>?</code> ä¸ºèµ·å§‹ã€ï¼Œæ‰€ä»¥ä¸æ¥å‚æ•°å°±ä¸ç”¨å¸¦è¿™ä¸ªé—®å·ã€‚</p><p>ï¼ˆè¿™ä¸€å¥—æœºåˆ¶ä¹Ÿå› ä¸ºçµæ´»é«˜æ•ˆæ–¹ä¾¿è€Œå—ä¼—äºå„iOSç»„ä»¶åŒ–å¼€å‘è§£å†³æ–¹æ¡ˆï¼‰ </p><p><strong>é€šç”¨çš„è§„åˆ™</strong>ï¼š</p><ul><li><p>å†’å·<code>:</code>ï¼šåœ¨<strong>é“¾æ¥å¤´</strong>å’Œ<strong>å‘½ä»¤</strong>ä¹‹é—´ï¼›</p></li><li><p>åŒæ–œæ  <code>//</code>ï¼šåœ¨<strong>é“¾æ¥å¤´å’Œå‘½ä»¤</strong>ä¹‹é—´ï¼Œæœ‰æ—¶ä¼šæ˜¯ä¸‰æ–œæ  <code>///</code>ï¼›</p></li><li><p>é—®å· <code>?</code>ï¼šåœ¨<strong>å‘½ä»¤å’Œå‚æ•°</strong>ä¹‹é—´ï¼›</p></li><li><p>ç­‰å· <code>=</code>ï¼šåœ¨<strong>å‚æ•°å’Œå€¼</strong>ä¹‹é—´ï¼›</p></li><li><p>ã€Œå’Œã€ç¬¦å· <code>&amp;</code>ï¼šåœ¨<strong>ä¸€ç»„å‚æ•°å’Œå¦ä¸€ç»„å‚æ•°</strong>ä¹‹é—´ã€‚</p></li></ul><p><strong>Tips</strong>ï¼š</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨safari è®¿é—®ï¼š<em>URL Scheme</em>://ï¼Œå°±å¯ä»¥å”¤é†’å¯¹åº”çš„ APPï¼Œå¯ä»¥ç”¨æ­¤æ¥æµ‹è¯•æ˜¯å¦ç»™è‡ªå·±çš„appé…åˆ¶æ­£ç¡®ã€‚</p><h2 id="URL-Scheme-è·³è½¬ä½¿ç”¨"><a href="#URL-Scheme-è·³è½¬ä½¿ç”¨" class="headerlink" title="URL Scheme è·³è½¬ä½¿ç”¨"></a>URL Scheme è·³è½¬ä½¿ç”¨</h2><p>ä»¥è·³è½¬æ”¯ä»˜å®è¿›è¡Œæ”¯ä»˜ä¸ºä¾‹ï¼š</p><ol><li>åœ¨infor.plistæ–‡ä»¶ä¸­æ·»åŠ  <strong>LSApplicationQueriesSchemes</strong> æ•°ç»„ï¼Œç›´æ¥ç‚¹å‡»â€œ+â€å·ï¼Œåœ¨valueä¸€æ å¡«ä¸Šæ”¯ä»˜å®çš„Schemeâ€”â€”â€œalipayâ€ï¼›</li></ol><blockquote><p><code>LSApplicationQueriesSchemes</code>ï¼šæ˜¯åœ¨iOS 9 ä»¥åè‹¹æœæ–°å¢çš„ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªç±»åˆ«å¢åŠ ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨<code>UIApplication</code>çš„<code>canOpenURL:</code>æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å®‰è£…äº†è¿™ä¸ª URL scheme å¯¹åº”çš„ APPã€‚å¦åˆ™ä¼šæŠ¥é”™æç¤ºï¼š<code>-canOpenURL: failed for URL: &quot;xxx://&quot; - error: &quot;This app is not allowed to query for scheme xxx&quot;</code>ï¼›å¦‚æœç›´æ¥è°ƒç”¨è·³è½¬ä»£ç è·³è½¬åˆ°ä¸å­˜åœ¨çš„app ä¹Ÿä¼šå´©æºƒã€‚</p></blockquote><ol start="2"><li><p>*<em>UIApplication - canOpenURL: *</em>åˆ¤æ–­æˆ‘ä»¬çš„ç›®æ ‡appæ˜¯å¦æœ‰å®‰è£…åœ¨æœ¬æœº</p></li><li><p>*<em>UIApplication - openURL: *</em>æ¥æ‹‰èµ·å¯¹åº”çš„app</p></li></ol><blockquote><p>iOS 10ä¸­ï¼Œè¯¥æ–¹æ³•è¢«<code>openURL:options:completionHandler:</code>æ–¹æ³•æ›¿ä»£ã€‚</p></blockquote><h2 id="å®šä¹‰è‡ªå·±URL-Scheme-è®©å…¶å®ƒappè·³è½¬"><a href="#å®šä¹‰è‡ªå·±URL-Scheme-è®©å…¶å®ƒappè·³è½¬" class="headerlink" title="å®šä¹‰è‡ªå·±URL Scheme è®©å…¶å®ƒappè·³è½¬"></a>å®šä¹‰è‡ªå·±URL Scheme è®©å…¶å®ƒappè·³è½¬</h2><p>URL Schemeå¿…é¡»èƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªAPPï¼Œå¦‚æœä½ è®¾ç½®çš„URL Schemeä¸åˆ«çš„APPçš„URL Schemeå†²çªæ—¶ï¼Œä½ çš„APPä¸ä¸€å®šä¼šè¢«å¯åŠ¨èµ·æ¥ã€‚å› ä¸ºå½“ä½ çš„APPåœ¨å®‰è£…çš„æ—¶å€™ï¼Œç³»ç»Ÿé‡Œé¢å·²ç»æ³¨å†Œäº†ä½ çš„URL Schemeã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¯ä¼šè°ƒç”¨å…ˆå®‰è£…çš„appã€‚ä½†æ˜¯iOSçš„ç³»ç»Ÿappçš„URL Schemeè‚¯å®šæ˜¯æœ€é«˜çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å®šä¹‰URL Schemeçš„æ—¶å€™ï¼Œå°½é‡é¿å¼€ç³»ç»Ÿappå·²ç»å®šä¹‰è¿‡çš„URL Schemeã€‚</p><p>æ“ä½œæ­¥éª¤ï¼š</p><ul><li><p>åœ¨info.plistæ–‡ä»¶ä¸­æ·»åŠ  <strong>CFBundleURLTypes</strong> æ•°ç»„ï¼Œç»™æ¯ä¸€ä¸ªitemçš„<code>CFBundleURLSchemes</code>å¡«å€¼ï¼ŒåŒæ—¶å¯ä»¥ç»™ä»–ä»¬ä¸€ä¸ªæ ‡ç¤ºåœ¨<code>CFBundleURLName</code>é‡Œã€‚</p></li><li><p>å¦‚æœç›´æ¥æ“ä½œinfo.plistæ–‡ä»¶ä¸æ˜ç™½ï¼Œå¯ä»¥æŒ‰è¿™æ ·çš„æ­¥éª¤æ·»åŠ ï¼š</p><blockquote><p>ç‚¹å‡»å·¥ç¨‹å-&gt;target-&gt;Info-&gt;URL Types-&gt;ç‚¹å‡»â€œ+â€å·*ï¼Œ</p><p>ç„¶åæŒ‰éœ€å¡«å†™<code>URL Scheme</code>ç­‰å‚æ•°ï¼Œå†å›å¤´çœ‹infoæ–‡ä»¶å°±æœ‰å€¼äº†ã€‚</p></blockquote></li></ul><p>å½“ä½ å®Œæˆäº†è¿™äº›ï¼Œå…¶å®ƒappå°±å¯ä»¥æ ¹æ®ä½ çš„schemeæ‹‰èµ·ä½ çš„appã€‚</p><h3 id="æ‹‰èµ·appåçš„æ“ä½œ"><a href="#æ‹‰èµ·appåçš„æ“ä½œ" class="headerlink" title="æ‹‰èµ·appåçš„æ“ä½œ"></a>æ‹‰èµ·appåçš„æ“ä½œ</h3><p>åœ¨<code>AppDelegate</code>ä¸­å®ç°ç³»ç»Ÿæ–¹æ³• <strong>application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey,id&gt; *)options</strong></p><p>å°±å¯ä»¥è§£æä¼ é€’è¿‡æ¥çš„URL Scheme ï¼Œå®šåˆ¶ä½ è¦æ‹‰èµ·çš„é¡µé¢ å‘é€çš„è¯·æ±‚ ä¼ é€’çš„è¯·æ±‚å‚æ•° åŠå›è°ƒã€‚</p><h2 id="iOS10ä»¥ä¸Šç³»ç»Ÿå¸¸ç”¨URL-Scheme"><a href="#iOS10ä»¥ä¸Šç³»ç»Ÿå¸¸ç”¨URL-Scheme" class="headerlink" title="iOS10ä»¥ä¸Šç³»ç»Ÿå¸¸ç”¨URL Scheme"></a>iOS10ä»¥ä¸Šç³»ç»Ÿå¸¸ç”¨URL Scheme</h2><p><strong>è®¾ç½®é¡µé¢</strong>  App-Prefs:root</p><p>(ä¹‹å‰åœ¨é‚£ä¸ªè®¾ç½®é¡µé¢ï¼Œå°±è·³è½¬åˆ°ç›¸åº”çš„è®¾ç½®é¡µé¢)</p><p><strong>æ— çº¿å±€åŸŸç½‘</strong>  App-Prefs:root=WIFI</p><p><strong>è“ç‰™</strong>  App-Prefs:root=Bluetooth</p><p><strong>èœ‚çªç§»åŠ¨ç½‘ç»œ</strong>  App-Prefs:root=MOBILE_DATA_SETTINGS_ID</p><p><strong>ä¸ªäººçƒ­ç‚¹</strong>  App-Prefs:root=INTERNET_TETHERING</p><p><strong>è¿è¥å•†</strong>  App-Prefs:root=Carrier</p><p><strong>é€šçŸ¥</strong>  App-Prefs:root=NOTIFICATIONS_ID</p><p><strong>é€šç”¨</strong>  App-Prefs:root=General</p><p><strong>é€šç”¨-å…³äºæœ¬æœº</strong>  App-Prefs:root=General&amp;path=About</p><p><strong>é€šç”¨-é”®ç›˜</strong>  App-Prefs:root=General&amp;path=Keyboard</p><p><strong>é€šç”¨-è¾…åŠ©åŠŸèƒ½</strong>  App-Prefs:root=General&amp;path=ACCESSIBILITY</p><p><strong>é€šç”¨-è¯­è¨€ä¸åœ°åŒº</strong>  App-Prefs:root=General&amp;path=INTERNATIONAL</p><p><strong>é€šç”¨-è¿˜åŸ</strong>  App-Prefs:root=Reset</p><p><strong>å¢™çº¸</strong>  App-Prefs:root=Wallpaper</p><p><strong>Siri</strong>  App-Prefs:root=SIRI</p><p><strong>éšç§</strong>  App-Prefs:root=Privacy</p><p><strong>Safari</strong>  App-Prefs:root=SAFARI</p><p><strong>éŸ³ä¹</strong>  App-Prefs:root=MUSIC</p><p><strong>éŸ³ä¹-å‡è¡¡å™¨</strong>  App-Prefs:root=MUSIC&amp;path=com.apple.Music:EQ</p><p><strong>ç…§ç‰‡ä¸ç›¸æœº</strong>  App-Prefs:root=Photos</p><p><strong>FaceTime</strong>  App-Prefs:root=FACETIME</p>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> URL Scheme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOS-é•‚ç©ºæ•ˆæœé®ç½©</title>
      <link href="/iOS-%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C%E9%81%AE%E7%BD%A9.html"/>
      <url>/iOS-%E9%95%82%E7%A9%BA%E6%95%88%E6%9E%9C%E9%81%AE%E7%BD%A9.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>åšæ–°æ‰‹æŒ‡å¼•/æ‰«æäºŒç»´ç ç­‰çš„éœ€è¦çš„é•‚ç©ºæ•ˆæœã€‚</p></blockquote><a id="more"></a><h1 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h1><p>(é¢ï¼Œæ¯›ç»ç’ƒæ˜¯æˆ‘åæœŸåŠ çš„ä¸ºäº†ä¿æŠ¤éšç§å®é™…æ˜¯æ²¡æœ‰è¿™ä¸€å±‚çš„)</p><p><a href="https://imgchr.com/i/G0XpX6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/05/G0XpX6.png" alt="G0XpX6.png"></a></p><h1 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">draw</span><span class="params">(<span class="number">_</span> rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.draw(rect)</span><br><span class="line">        </span><br><span class="line">        clearBgView.layer.sublayers?.removeAll()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…¨è·¯å¾„</span></span><br><span class="line">        <span class="keyword">let</span> bgPath = <span class="type">UIBezierPath</span>(rect: <span class="keyword">self</span>.bounds)</span><br><span class="line">        <span class="comment">// é•‚ç©ºè·¯å¾„</span></span><br><span class="line">        <span class="keyword">let</span> hollowPath = <span class="type">UIBezierPath</span>(roundedRect: hollowRects[idx], cornerRadius: <span class="number">4</span>)</span><br><span class="line">        bgPath.append(hollowPath)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // è™šçº¿éƒ¨åˆ†ï¼ˆéœ€æ±‚ï¼Œå¯ä»¥ä¸å†™ï¼‰</span></span><br><span class="line"><span class="comment">        let line = CAShapeLayer()</span></span><br><span class="line"><span class="comment">        line.fillColor = UIColor.clear.cgColor</span></span><br><span class="line"><span class="comment">        line.strokeColor = UIColor.white.cgColor</span></span><br><span class="line"><span class="comment">        line.lineWidth = 1</span></span><br><span class="line"><span class="comment">        line.lineDashPattern = [3, 3]</span></span><br><span class="line"><span class="comment">        line.path = hollowPath.cgPath</span></span><br><span class="line"><span class="comment">        clearBgView.layer.addSublayer(line)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">        <span class="comment">// é®ç½©</span></span><br><span class="line">        <span class="keyword">let</span> mask = <span class="type">CAShapeLayer</span>()</span><br><span class="line">        mask.path = bgPath.cgPath</span><br><span class="line">        mask.fillRule = kCAFillRuleEvenOdd</span><br><span class="line">        <span class="comment">//mask.fillColor = UIColor.black.cgColor</span></span><br><span class="line">        <span class="comment">//mask.opacity = 0.7</span></span><br><span class="line">        clearBgView.layer.addSublayer(mask)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="comment">//... åœ¨è¿™é‡Œæ·»åŠ æˆ–ä¿®æ”¹ image/label</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ¯æ¬¡ç‚¹å‡»ï¼Œå°±è°ƒç”¨<strong><code>self.setNeedsDisplay()</code></strong>ï¼Œå”¤èµ·<code>drawRect</code>æ–¹æ³•é‡ç»˜è§†å›¾</p></li><li><span class="label info">hollowPath</span> ï¼šé•‚ç©ºè·¯å¾„ã€‚æ¯æ¬¡ç‚¹å‡»å°±æ ¹æ®ä¼ å…¥çš„hollowRectsæ•°ç»„ä¿®æ”¹é•‚ç©ºpathçš„rectï¼Œå¹¶ä¸”é‡æ–°å°†hollowPath append åˆ° bgPathï¼Œè®¾ç½®äº†EvenOddå±æ€§ä¹‹åï¼Œåˆ™é‡å éƒ¨åˆ†è·¯å¾„æ‰ä¼šæ¸²æŸ“ï¼ˆå¥‡å¶åŸåˆ™ï¼Œå¶æ•°è·¯å¾„å†…è§†ä¸ºå¤–éƒ¨ï¼Œä¸å¡«å……ï¼‰</li><li><span class="label warning">clearBgView</span>ï¼šè‡ªå®šä¹‰åœ¨è§†å›¾æ§åˆ¶å™¨è§†å›¾ä¸Šçš„èƒŒæ™¯ã€‚å¦‚æœclearBgViewæ˜¯åŠé€æ˜é»‘è‰²ï¼Œé‚£ä¹ˆç›´æ¥ç»™ä»–è®¾ç½®maské®ç½©å°±è¡Œäº†ï¼›å¦‚æœ clearBgViewæ˜¯é€æ˜çš„ï¼Œé‚£ä¹ˆé®ç½©å°±å¿…é¡»åŠ ä¸ŠfillColorå¡«å……è‰²å’ŒopacityåŠé€æ˜å±æ€§ã€‚</li><li><span class="label success">maskView</span>ï¼šå®ç°åŠé€æ˜çš„é®ç½©ã€‚maskViewè¦è®¾ç½® **`usesEvenOddFillRule`** ä¸ºtrue</li></ul><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><p>é®ç½©å±‚çš„fillRuleå±æ€§ï¼Œ<code>even-odd rule</code>ä¸<code>non-zero rule</code>åˆ°åº•ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ</p><h3 id="å¥‡å¶è§„åˆ™-even-odd-rule"><a href="#å¥‡å¶è§„åˆ™-even-odd-rule" class="headerlink" title="å¥‡å¶è§„åˆ™(even-odd rule)"></a>å¥‡å¶è§„åˆ™(even-odd rule)</h3><blockquote><p>æŒ‡ä»è·¯å¾„åŒ…å›´çš„åŒºåŸŸä»»æ„ç‚¹å‘å¤–åšä¸€æ¡å°„çº¿ï¼Œå¦‚æœå°„çº¿ç›¸äº¤çš„è¾¹æ•°æ€»å’Œä¸ºå¥‡æ•°ï¼Œåˆ™è®¤ä¸ºè¯¥ç‚¹åœ¨è·¯å¾„å†…éƒ¨ï¼Œå¡«å……ç›¸åº”åŒºåŸŸã€‚</p><p>å¦‚æœäº¤å‰ç‚¹çš„æ•°é‡ä¸ºå¶æ•°ï¼Œåˆ™è®¤ä¸ºè¯¥ç‚¹åœ¨è·¯å¾„ä¹‹å¤–ï¼Œå¹¶ä¸”è¯¥åŒºåŸŸæœªè¢«å¡«å……ã€‚</p></blockquote><h3 id="éé›¶è§„åˆ™-non-zero-rule"><a href="#éé›¶è§„åˆ™-non-zero-rule" class="headerlink" title="éé›¶è§„åˆ™(non-zero rule)"></a>éé›¶è§„åˆ™(non-zero rule)</h3><blockquote><p>å¯¹äºï¼Œä»å·¦åˆ°å³è·¯å¾„çš„äº¤å‰ç‚¹ç®—ä½œ+1ï¼Œä»å³åˆ°å·¦è·¯å¾„çš„äº¤å‰ç‚¹ç®—ä½œ-1ã€‚</p><p>å¦‚æœäº¤å‰çš„æ€»å’Œä¸ä¸ºé›¶ï¼Œåˆ™è®¤ä¸ºè¯¥ç‚¹åœ¨è·¯å¾„å†…ï¼Œå¹¶ä¸”ç›¸åº”çš„åŒºåŸŸè¢«å¡«å……ã€‚</p><p>å¦‚æœæ€»å’Œä¸º0ï¼Œåˆ™è¯¥ç‚¹åœ¨è·¯å¾„ä¹‹å¤–ï¼Œå¹¶ä¸”è¯¥åŒºåŸŸæœªè¢«å¡«å……ã€‚</p></blockquote><p>Tips: å¦‚æœé•‚ç©ºéƒ¨åˆ†æ˜¯åœ†å½¢æˆ–è€…æ¤­åœ†å½¢ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿<code>clockwise</code>å±æ€§ä¸º<code>false</code>ï¼Œä¸ç”¨ä¿®æ”¹<code>usesEvenOddFillRule</code>å±æ€§ï¼Œé»˜è®¤å°±æ˜¯éé›¶è§„åˆ™ï¼ä¹Ÿå¯è¾¾åˆ°é•‚ç©ºæ•ˆæœå™¢ã€‚</p><p>è¿™ç¯‡æ–‡ç« å¯¹äºè¿™ä¸¤ä¸ªå±æ€§çš„åˆ†æå°±å¾ˆè¯¦ç»†ï¼š <a href="https://segmentfault.com/a/1190000022769490" target="_blank" rel="noopener">https://segmentfault.com/a/1190000022769490</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> å¼€å‘ä¹‹æœ¯ </tag>
            
            <tag> é•‚ç©º </tag>
            
            <tag> BezierPath </tag>
            
            <tag> CAShapeLayer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOS-swiftå•ä¾‹&amp;å¯é”€æ¯å•ä¾‹</title>
      <link href="/iOS-swift%E5%8D%95%E4%BE%8B-%E5%8F%AF%E9%94%80%E6%AF%81%E5%8D%95%E4%BE%8B.html"/>
      <url>/iOS-swift%E5%8D%95%E4%BE%8B-%E5%8F%AF%E9%94%80%E6%AF%81%E5%8D%95%E4%BE%8B.html</url>
      
        <content type="html"><![CDATA[<div class="note primary"><p>è¿™å¯èƒ½æ˜¯ä½ å­¦è¿‡çš„ç¬¬ä¸€ç§è®¾è®¡æ¨¡å¼</p></div><a id="more"></a><h1 id="å•ä¾‹ç›¸å…³"><a href="#å•ä¾‹ç›¸å…³" class="headerlink" title="å•ä¾‹ç›¸å…³"></a>å•ä¾‹ç›¸å…³</h1><blockquote><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Pattenï¼‰æ˜¯æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚</p></blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹,ä½¿ç”¨â€sharedâ€  â€œsharedInstanceâ€  â€œdefaultâ€  â€œstandardâ€ç­‰å­—æ ·çš„,å°±æ˜¯å•ä¾‹.</p><h2 id="åŸºæœ¬è¦æ±‚"><a href="#åŸºæœ¬è¦æ±‚" class="headerlink" title="åŸºæœ¬è¦æ±‚"></a>åŸºæœ¬è¦æ±‚</h2><ul><li>åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹</li><li>å¿…é¡»å†…éƒ¨è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹</li><li>å¿…é¡»å¯¹æ‰€æœ‰å…¶å®ƒå¯¹è±¡æä¾›è¯¥å”¯ä¸€å®ä¾‹</li></ul><h2 id="iOS-ä¸­çš„å•ä¾‹"><a href="#iOS-ä¸­çš„å•ä¾‹" class="headerlink" title="iOS ä¸­çš„å•ä¾‹"></a>iOS ä¸­çš„å•ä¾‹</h2><ul><li><p><code>UIApplication.shard</code> ï¼šæ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯åŠ¨ååˆ›å»ºçš„ç¬¬ä¸€ä¸ªå•ä¾‹å¯¹è±¡å°±æ˜¯UIApplicationå¯¹è±¡ï¼Œåˆ©ç”¨UIApplicationå¯¹è±¡èƒ½è¿›è¡Œä¸€äº›åº”ç”¨çº§åˆ«çš„æ“ä½œ</p></li><li><p><code>NotificationCenter.defualt</code>ï¼šé€šçŸ¥ä¸­å¿ƒï¼Œç®¡ç†åº”ç”¨ä¸­çš„é€šçŸ¥</p></li><li><p><code>FileManager.defualt</code>ï¼šè·å–æ²™ç›’ä¸»ç›®å½•çš„è·¯å¾„</p></li><li><p><code>URLSession.shared</code>ï¼šç®¡ç†ç½‘ç»œè¿æ¥</p></li><li><p><code>UserDefaults.standard</code>ï¼šå­˜å‚¨è½»é‡çº§çš„æœ¬åœ°æ•°æ®</p></li><li><p><code>SKPaymentQueue.default()</code>ï¼šç®¡ç†åº”ç”¨å†…è´­çš„é˜Ÿåˆ—ã€‚ç³»ç»Ÿä¼šç”¨ <strong>StoreKit</strong> framework åˆ›å»ºä¸€ä¸ªæ”¯ä»˜é˜Ÿåˆ—ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶é€šè¿‡ç±»æ–¹æ³• <code>default()</code> å»è·å–è¿™ä¸ªé˜Ÿåˆ—ã€‚</p></li></ul><h2 id="å•ä¾‹çš„ä¼˜ç¼ºç‚¹"><a href="#å•ä¾‹çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="å•ä¾‹çš„ä¼˜ç¼ºç‚¹"></a>å•ä¾‹çš„ä¼˜ç¼ºç‚¹</h2><span class="label success">ä¼˜ç‚¹ï¼š</span><ul><li><p><strong>æä¾›äº†å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®</strong>ï¼šå•ä¾‹ç±»å°è£…äº†å®ƒçš„å”¯ä¸€å®ä¾‹ï¼Œé˜²æ­¢å…¶å®ƒå¯¹è±¡å¯¹è‡ªå·±çš„å®ä¾‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰çš„å¯¹è±¡éƒ½è®¿é—®ä¸€ä¸ªå®ä¾‹ã€‚</p></li><li><p><strong>èŠ‚çº¦ç³»ç»Ÿèµ„æº</strong>ï¼šç”±äºåœ¨ç³»ç»Ÿå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ï¼Œå•ä¾‹æ¨¡å¼æ— ç–‘å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p></li><li><p><strong>ä¼¸ç¼©æ€§</strong>ï¼šå•ä¾‹æ¨¡å¼çš„ç±»è‡ªå·±æ¥æ§åˆ¶å®ä¾‹åŒ–è¿›ç¨‹ï¼Œç±»å°±åœ¨æ”¹å˜å®ä¾‹åŒ–è¿›ç¨‹ä¸Šæœ‰ç›¸åº”çš„ä¼¸ç¼©æ€§ã€‚</p></li><li><p><strong>é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨</strong>ï¼šæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼Œç”±äºåªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…å¯¹åŒä¸€ä¸ªèµ„æºæ–‡ä»¶çš„åŒæ—¶å†™æ“ä½œ</p></li></ul><span class="label danger">ç¼ºç‚¹ï¼š</span><ul><li><p><strong>çŠ¶æ€æ··ä¹±</strong>ï¼šç”±äºå•ä¾‹æ˜¯å…±äº«çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªå¯¹è±¡éƒ½ä¼šè®¿é—®åŠæ”¹å˜å•ä¾‹çš„çŠ¶æ€ï¼Œæ‰€ä»¥å½“ä½¿ç”¨å•ä¾‹æ—¶ï¼Œç¨‹åºå‘˜æ— æ³•æ¸…æ¥šçš„çŸ¥é“å•ä¾‹å½“å‰çš„çŠ¶æ€ã€‚</p></li><li><p><strong>æµ‹è¯•å›°éš¾</strong>ï¼šæµ‹è¯•å›°éš¾ä¸»è¦æ˜¯ç”±äºå•ä¾‹çŠ¶æ€çš„æ··ä¹±è€Œé€ æˆçš„ã€‚å› ä¸ºå•ä¾‹çš„çŠ¶æ€å¯ä»¥è¢«å…¶ä»–å…±äº«çš„å®ä¾‹æ‰€ä¿®æ”¹ï¼Œæ‰€ä»¥è¿›è¡Œéœ€è¦ä¾èµ–å•ä¾‹çš„æµ‹è¯•æ—¶ï¼Œå¾ˆéš¾ä»ä¸€ä¸ªå¹²å‡€ã€æ¸…æ™°çš„çŠ¶æ€å¼€å§‹æ¯ä¸€ä¸ª test case</p></li><li><p><strong>è®¿é—®æ··ä¹±</strong>ï¼šç”±äºå•ä¾‹æ˜¯å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥æ— æ³•å¯¹è®¿é—®æƒé™ä½œå‡ºé™å®šã€‚ç¨‹åºä»»ä½•ä½ç½®ã€ä»»ä½•å®ä¾‹éƒ½å¯ä»¥å¯¹å•ä¾‹è¿›è¡Œè®¿é—®ï¼Œå®¹æ˜“å¼•èµ·è®¿é—®æ··ä¹±ã€‚</p></li></ul><h1 id="Objective-Cå•ä¾‹"><a href="#Objective-Cå•ä¾‹" class="headerlink" title="Objective-Cå•ä¾‹"></a>Objective-Cå•ä¾‹</h1><ol><li><p>åœ¨.hæ–‡ä»¶ä¸­å¼€æ”¾å•ä¾‹ç±»æ–¹æ³•çš„æ¥å£ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instanceType)sharedInstance;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>åœ¨.mæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œå–„ç”¨GCDå®ç°å•ä¾‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> MySingleton *sharedInstance = <span class="literal">nil</span>;</span><br><span class="line">+ (instanceType)sharedInstance &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> once;</span><br><span class="line">  disptach_once(&amp;once, ^&#123;</span><br><span class="line">    sharedInstance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="Swiftå•ä¾‹"><a href="#Swiftå•ä¾‹" class="headerlink" title="Swiftå•ä¾‹"></a>Swiftå•ä¾‹</h1><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><h3 id="ç¬¬ä¸€ç§æ–¹å¼ï¼š"><a href="#ç¬¬ä¸€ç§æ–¹å¼ï¼š" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼ï¼š"></a>ç¬¬ä¸€ç§æ–¹å¼ï¼š</h3><p>æœ€ç®€æ´çš„æ–¹å¼ï¼Œå°†å®ä¾‹å®šä¹‰ä¸ºå…¨å±€å˜é‡ã€‚</p><blockquote><p>å¦‚æœå°†ä¸Šè¿°å®ä¾‹å˜é‡åœ¨å…¨å±€å‘½ååŒºï¼ˆglobal namespaceï¼‰ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œç”±äºSwiftä¸­<strong>å…¨å±€å˜é‡æ˜¯æ‡’åŠ è½½ï¼ˆlazy initializeï¼‰</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨<code>application(_:didFinishLaunchingWithOptions:)</code>ä¸­è°ƒç”¨çš„æ—¶å€™ä¹‹åï¼Œ<code>shardManager</code>ä¼šåœ¨<code>AppDelegate</code>ç±»ä¸­è¢«åˆå§‹åŒ–ï¼Œä¹‹åç¨‹åºä¸­æ‰€æœ‰è°ƒç”¨<code>sharedManager</code>å®ä¾‹çš„åœ°æ–¹å°†éƒ½ä½¿ç”¨è¯¥å®ä¾‹ã€‚</p></blockquote><blockquote><p>å¦å¤–ï¼ŒSwift å…¨å±€å˜é‡åˆå§‹åŒ–æ—¶é»˜è®¤ä½¿ç”¨<code>dispatch_once</code>ï¼Œè¿™ä¿è¯äº†å…¨å±€å˜é‡çš„æ„é€ å™¨ï¼ˆinitializerï¼‰åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¿è¯äº†<code>shardManager</code>çš„<strong>åŸå­æ€§</strong>ã€‚</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å…¨å±€å‘½ååŒºåˆ›å»ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> sharedSingleton = <span class="type">MySingleton</span>(string: someString)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> string: <span class="type">String</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">init</span>(string: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.string = string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–éƒ¨ç›´æ¥ä½¿ç”¨sharedInstance</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: <span class="keyword">Any</span>]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä½ç½®ï¼Œä»¥åŠä½¿ç”¨æ–¹å¼</span></span><br><span class="line">    <span class="built_in">print</span>(sharedSingleton)</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç§æ–¹å¼ï¼šï¼ˆä½¿ç”¨æœ€å¤šçš„æ–¹å¼ï¼‰"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼šï¼ˆä½¿ç”¨æœ€å¤šçš„æ–¹å¼ï¼‰" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼šï¼ˆä½¿ç”¨æœ€å¤šçš„æ–¹å¼ï¼‰"></a>ç¬¬äºŒç§æ–¹å¼ï¼šï¼ˆä½¿ç”¨æœ€å¤šçš„æ–¹å¼ï¼‰</h3><p>ä½¿ç”¨<code>static</code>ã€<code>private</code>å…³é”®å­—ï¼Œé™å®šå˜é‡çš„ä½œç”¨åŸŸã€‚</p><p>â€œstaticâ€å…³é”®å­—ä½¿<code>shard</code>æˆä¸ºå…¨å±€å˜é‡ï¼Œâ€œprivateâ€å…³é”®å­—ä¿è¯äº†å•ä¾‹çš„åŸå­æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">MySingleton</span>(string: someString)</span><br><span class="line">  <span class="comment">// å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> string: <span class="type">String</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">init</span>(string: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.string = string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="type">MySingleton</span>.shared</span><br></pre></td></tr></table></figure><p><strong>é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼å®ç°å•ä¾‹ï¼Œä»£ç çš„å¯è¯»æ€§å¢åŠ äº†ï¼Œèƒ½å¤Ÿç›´è§‚çš„åˆ†è¾¨å‡ºè¿™æ˜¯ä¸€ä¸ªå•ä¾‹</strong>ã€‚</p><h3 id="ç¬¬ä¸‰ç§æ–¹å¼ï¼š"><a href="#ç¬¬ä¸‰ç§æ–¹å¼ï¼š" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼ï¼š"></a>ç¬¬ä¸‰ç§æ–¹å¼ï¼š</h3><p>ç¬¬ä¸‰ç§æ–¹å¼æ˜¯ç¬¬äºŒç§æ–¹å¼çš„å˜ç§ï¼Œæ›´åŠ å¤æ‚ã€‚</p><p>è®©å•ä¾‹åœ¨é—­åŒ…ï¼ˆClosureï¼‰ä¸­åˆå§‹åŒ–ï¼ŒåŒæ—¶åŠ å…¥ç±»æ–¹æ³•æ¥è·å–å•ä¾‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">let</span> sharedInstance: <span class="type">MySingleton</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> shared = <span class="type">MySingleton</span>(string: someString)</span><br><span class="line">    <span class="comment">// ...å…¶å®ƒé…ç½®</span></span><br><span class="line">    <span class="keyword">return</span> shared</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="comment">// å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> string: <span class="type">String</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">init</span>(string: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.string = string</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¯¹å¤–æ¥å£</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">shared</span>() -&gt; <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sharedInstance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºç¬¬ä¸‰ç§æ–¹å¼è™½ç„¶æ›´åŠ å¤æ‚ï¼Œä½†æ˜¯å¯ä»¥åœ¨é—­åŒ…ä¸­ä½œä¸€äº›é¢å¤–çš„é…ç½®ã€‚åŒæ—¶ï¼Œè°ƒç”¨å•ä¾‹çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œéœ€è¦è°ƒç”¨å•ä¾‹ä¸­çš„ç±»æ–¹æ³•<code>shared()</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="type">MySingleton</span>.shared()</span><br></pre></td></tr></table></figure><h2 id="å¯é”€æ¯å•ä¾‹"><a href="#å¯é”€æ¯å•ä¾‹" class="headerlink" title="å¯é”€æ¯å•ä¾‹"></a>å¯é”€æ¯å•ä¾‹</h2><p>è™½è¯´å•ä¾‹æ˜¯å…¨å±€å”¯ä¸€ï¼Œä½†æ˜¯é‡åˆ°éœ€è¦é™å®šå•ä¾‹çš„ä½œç”¨åŸŸåœ¨æŸä¸ªåº“ï¼ŒæŸä¸ªæ¡†æ¶é‡Œï¼Œå½“popå›åˆ°ä¸»å·¥ç¨‹ï¼Œç¦»å¼€ç§æœ‰æ¡†æ¶ä½œç”¨åŸŸæ—¶æƒ³è¦è®©å•ä¾‹é”€æ¯ï¼Œä¸‹æ¬¡è¿›å…¥å†åˆå§‹åŒ–ã€‚å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">var</span> _sharedInstance: <span class="type">MySingleton?</span></span><br><span class="line">  <span class="comment">// å±æ€§</span></span><br><span class="line">  <span class="keyword">let</span> string: <span class="type">String</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">init</span>(string: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.string = string</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">shared</span>() -&gt; <span class="title">MySingleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> instance = _sharedInstance <span class="keyword">else</span> &#123;</span><br><span class="line">      _sharedInstance = <span class="type">MySingleton</span>(string: someString)</span><br><span class="line">      <span class="keyword">return</span> _sharedInstance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é”€æ¯</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">destroy</span>() </span>&#123;</span><br><span class="line">    _sharedInstance = <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨æ–¹å¼</span></span><br><span class="line"><span class="type">MySingleton</span>.shared()</span><br><span class="line"><span class="type">MySingleton</span>.destroy()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> swift </tag>
            
            <tag> Singleton </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOS-åŠ¨æ€åŠ è½½å­—ä½“ï¼ˆç»™Cocoapodåº“æ·»åŠ è‡ªå®šä¹‰å­—ä½“æ–‡ä»¶ï¼‰</title>
      <link href="/iOS-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E4%BD%93%EF%BC%88%E7%BB%99Cocoapod%E5%BA%93%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%EF%BC%89.html"/>
      <url>/iOS-%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E4%BD%93%EF%BC%88%E7%BB%99Cocoapod%E5%BA%93%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%EF%BC%89.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>å•æƒ³ç»™è¯¥åº“å¢æ·»ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“åˆä¸æƒ³åˆ°ä¸»å·¥ç¨‹å»åšä¿®æ”¹ï¼Œä¿æŒä¸»å·¥ç¨‹å¹²å‡€å¹¶ä¸”è®©å­åº“å¯æœ‰è‡ªå·±ç‹¬æœ‰çš„å­—ä½“ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ </p></blockquote><a id="more"></a><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><blockquote><p>å­—ä½“æ–‡ä»¶åä¸ä»£è¡¨å­—ä½“çš„åå­—ï¼Œåœ¨å‘info.plist æ–‡ä»¶ä¸­æ·»åŠ å­—ä½“çš„æ—¶å€™æ·»åŠ çš„æ˜¯å­—ä½“æ–‡ä»¶çš„åå­—ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å­—ä½“çœŸæ­£çš„åå­—ï¼ŒæŸ¥æ‰¾æ–¹æ³•å¯ä»¥ï¼šå³é”®ç‚¹å‡»æ–‡ä»¶ -&gt; show in finder -&gt; æ–‡ä»¶æ ‡é¢˜æ˜¾ç¤ºçš„å°±æ˜¯å­—ä½“çš„çœŸåï¼›</p><p>æˆ–è€…é€šè¿‡éå†æ‰“å°æ‰€æœ‰ç³»ç»Ÿå®‰è£…çš„å­—ä½“æ–‡ä»¶æŸ¥æ‰¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; //è·å¾—å­—ä½“æ—çš„åå­—</span><br><span class="line">&gt; NSArray *arr = [UIFont familyNames];</span><br><span class="line">&gt; for (NSString *family in arr) &#123;</span><br><span class="line">&gt;    //æ‰“å°å­—ä½“æ—å</span><br><span class="line">&gt;    NSLog(@&quot;FamilyName:%@&quot;, family);</span><br><span class="line">&gt;    NSArray *arr2 = [UIFont fontNamesForFamilyName:family];</span><br><span class="line">&gt;    for (NSString *name in arr2) &#123;</span><br><span class="line">&gt;        //æ‰“å°å­—ä½“å</span><br><span class="line">&gt;        NSLog(@&quot;FontName:%@&quot;, name);</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h1 id="å¸¸è§„æ·»åŠ å­—ä½“æ­¥éª¤"><a href="#å¸¸è§„æ·»åŠ å­—ä½“æ­¥éª¤" class="headerlink" title="å¸¸è§„æ·»åŠ å­—ä½“æ­¥éª¤"></a>å¸¸è§„æ·»åŠ å­—ä½“æ­¥éª¤</h1><ol><li><p>è·å–åˆ°ä¸€ä¸ªå­—ä½“æ–‡ä»¶æ¯”å¦‚ â€œDS-DIGI-1.ttfâ€</p></li><li><p>åœ¨info.plistä¸­çš„â€Fonts provided by applicationâ€æ æ–°å¢ä¸€ä¸ªitemï¼Œå¡«å…¥ä½ è¦æ·»åŠ çš„å­—ä½“æ–‡ä»¶çš„æ–‡ä»¶åâ€DS-DIGI-1.ttfâ€</p></li><li><p>æŸ¥æ‰¾åˆ°æ­£ç¡®çš„å­—ä½“åï¼Œåœ¨é¡¹ç›®ä¸­è°ƒç”¨UIFont.fontWithNameä½¿ç”¨</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIFont</span>(name: <span class="string">"DS-Digital"</span>, size: <span class="number">22</span>)</span><br></pre></td></tr></table></figure></li></ol><h1 id="ç§æœ‰åº“æ·»åŠ å­—ä½“"><a href="#ç§æœ‰åº“æ·»åŠ å­—ä½“" class="headerlink" title="ç§æœ‰åº“æ·»åŠ å­—ä½“"></a>ç§æœ‰åº“æ·»åŠ å­—ä½“</h1><p>å½“å¼€å‘ç§æœ‰podåº“æ—¶ï¼Œå•æƒ³ç»™è¯¥åº“å¢æ·»ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“åˆæƒ³ä¿æŒä¸»å·¥ç¨‹å¹²å‡€ç‹¬ç«‹ï¼Œå¹¶ä¸”è®©å…¶å®ƒé¡¹ç›®å¼•ç”¨å­åº“ä¹Ÿä¸ç”¨æ‰‹åŠ¨å¯¼å…¥å­—ä½“ï¼Œå­åº“ä¹Ÿèƒ½æœ‰è‡ªå·±å•ç‹¬ç®¡ç†çš„å­—ä½“ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ </p><h3 id="CTFontManageråŠ¨æ€æ·»åŠ "><a href="#CTFontManageråŠ¨æ€æ·»åŠ " class="headerlink" title="CTFontManageråŠ¨æ€æ·»åŠ "></a>CTFontManageråŠ¨æ€æ·»åŠ </h3><ol start="0"><li><p>å°†å­—ä½“æ–‡ä»¶æ”¾åˆ°podåº“å¯¹åº”çš„resourceï¼ˆèµ„æºï¼‰æ–‡ä»¶å¤¹ä¸‹</p></li><li><p>æŸ¥æ‰¾åº“çš„bundleAï¼Œå†åˆ°bundleAæŸ¥æ‰¾å­—ä½“æ–‡ä»¶è·¯å¾„URL</p></li><li><p>è¿ç”¨CTFontManagerRegisterFontsForURLåŠ¨æ€åŠ è½½å­—ä½“</p></li><li><p>å†™æˆä¸€ä¸ªUIFontåˆ†ç±»ï¼ŒåŠ è½½åº“å‰è°ƒç”¨</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIFont</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">registerFont</span><span class="params">(bundle: Bundle, fontName: String, fontExtension: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> bundleURL = bundle.url(forResource: <span class="string">"MYComponent"</span>, withExtension: <span class="string">"bundle"</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"Couldn't find bundle MYComponent"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> myBundle = <span class="type">Bundle</span>(url: bundleURL)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> fontURL = myBundle?.url(forResource: fontName, withExtension: fontExtension) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"Couldn't find font \(fontName)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> version = <span class="type">Float</span>(<span class="type">UIDevice</span>.current.systemVersion), version &gt;= <span class="number">7.0</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> error: <span class="type">Unmanaged</span>&lt;<span class="type">CFError</span>&gt;?</span><br><span class="line">            <span class="keyword">if</span> !<span class="type">CTFontManagerRegisterFontsForURL</span>(fontURL <span class="keyword">as</span> <span class="type">CFURL</span>, .process, &amp;error) &#123;</span><br><span class="line">                <span class="built_in">debugPrint</span>(<span class="string">"Error registering font: maybe it was already registered. :%@"</span>, error.debugDescription)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> fontDataProvider = <span class="type">CGDataProvider</span>(url: fontURL <span class="keyword">as</span> <span class="type">CFURL</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">fatalError</span>(<span class="string">"Couldn't load data from the font \(fontName)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> font = <span class="type">CGFont</span>(fontDataProvider) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">fatalError</span>(<span class="string">"Couldn't create font from data"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> error: <span class="type">Unmanaged</span>&lt;<span class="type">CFError</span>&gt;?</span><br><span class="line">            <span class="comment">// å†…å­˜æ³„æ¼?</span></span><br><span class="line">            <span class="keyword">if</span> !<span class="type">CTFontManagerRegisterGraphicsFont</span>(font, &amp;error) &#123;</span><br><span class="line">                <span class="built_in">debugPrint</span>(<span class="string">"Error registering font: maybe it was already registered. :%@"</span>, error.debugDescription)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä½¿ç”¨æ–¹æ³•è¿˜æ˜¯fontWithNameå°±å¯ä»¥äº†ã€‚</p><h3 id="podSpecåŠ¨æ€æ·»åŠ "><a href="#podSpecåŠ¨æ€æ·»åŠ " class="headerlink" title="podSpecåŠ¨æ€æ·»åŠ "></a>podSpecåŠ¨æ€æ·»åŠ </h3><p>ç½‘ä¸Šè¿˜æœ‰ç”¨podSpecæ–‡ä»¶ï¼Œç¼–è¯‘è„šæœ¬è¿›è¡Œhookçš„æ–¹æ³•ï¼Œé€šè¿‡åœ¨resourcesæ–‡ä»¶ä¸­æœç´¢åˆ°å­—ä½“æ–‡ä»¶ï¼Œç„¶ååœ¨ç¼–è¯‘æœŸå†™å…¥åˆ°plistæ–‡ä»¶ï¼Œæ–¹æ³•å†™èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä¸”å¯¹rubyä¸ç†Ÿï¼Œç¬”è€…ç”¨è¿™ä¸ªæ–¹æ³•å¤±è´¥äº†å¸Œæœ›æœ‰<strong>å¤§ç¥èµæ•™</strong>ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Pod::Spec.new <span class="keyword">do</span> <span class="params">|s|</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  s.resources = <span class="string">"Resources/*.otf"</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  s.post_install <span class="keyword">do</span> <span class="params">|library_representation|</span></span><br><span class="line">    <span class="keyword">require</span> <span class="string">'rexml/document'</span></span><br><span class="line"></span><br><span class="line">    library = library_representation.library</span><br><span class="line">    proj_path = library.user_project_path</span><br><span class="line">    proj = Xcodeproj::Project.new(proj_path)</span><br><span class="line">    target = proj.targets.first <span class="comment"># good guess for simple projects</span></span><br><span class="line"></span><br><span class="line">    info_plists = target.build_configurations.inject([]) <span class="keyword">do</span> <span class="params">|memo, item|</span></span><br><span class="line">      memo &lt;&lt; item.build_settings[<span class="string">'INFOPLIST_FILE'</span>]</span><br><span class="line">    <span class="keyword">end</span>.uniq</span><br><span class="line">    info_plists = info_plists.map &#123; <span class="params">|plist|</span> File.join(File.dirname(proj_path), plist) &#125;</span><br><span class="line"></span><br><span class="line">    resources = library.file_accessors.collect(&amp;<span class="symbol">:resources</span>).flatten</span><br><span class="line">    fonts = resources.find_all &#123; <span class="params">|file|</span> File.extname(file) == <span class="string">'.otf'</span> <span class="params">||</span> File.extname(file) == <span class="string">'.ttf'</span> &#125;</span><br><span class="line">    fonts = fonts.map &#123; <span class="params">|f|</span> File.basename(f) &#125;</span><br><span class="line"></span><br><span class="line">    info_plists.each <span class="keyword">do</span> <span class="params">|plist|</span></span><br><span class="line">      doc = REXML::Document.new(File.open(plist))</span><br><span class="line">      main_dict = doc.elements[<span class="string">"plist"</span>].elements[<span class="string">"dict"</span>]</span><br><span class="line">      app_fonts = main_dict.get_elements(<span class="string">"key[text()='UIAppFonts']"</span>).first</span><br><span class="line">      <span class="keyword">if</span> app_fonts.<span class="literal">nil</span>?</span><br><span class="line">        elem = REXML::Element.new <span class="string">'key'</span></span><br><span class="line">        elem.text = <span class="string">'UIAppFonts'</span></span><br><span class="line">        main_dict.add_element(elem)</span><br><span class="line">        font_array = REXML::Element.new <span class="string">'array'</span></span><br><span class="line">        main_dict.add_element(font_array)</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        font_array = app_fonts.next_element</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      fonts.each <span class="keyword">do</span> <span class="params">|font|</span></span><br><span class="line">        <span class="keyword">if</span> font_array.get_elements(<span class="string">"string[text()='<span class="subst">#&#123;font&#125;</span>']"</span>).empty?</span><br><span class="line">          font_elem = REXML::Element.new <span class="string">'string'</span></span><br><span class="line">          font_elem.text = font</span><br><span class="line">          font_array.add_element(font_elem)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      doc.write(File.open(plist, <span class="string">'wb'</span>))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> å¼€å‘ä¹‹æœ¯ </tag>
            
            <tag> å­—ä½“ </tag>
            
            <tag> Cocoapods </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CocoaPodså’Œæ¼äººçš„New build system</title>
      <link href="/CocoaPods%E5%92%8C%E6%81%BC%E4%BA%BA%E7%9A%84New-build-system.html"/>
      <url>/CocoaPods%E5%92%8C%E6%81%BC%E4%BA%BA%E7%9A%84New-build-system.html</url>
      
        <content type="html"><![CDATA[<div class="note primary"><p>New build system æŠŠæˆ‘å‘æƒ¨äº†å•Š TAT</p></div><a id="more"></a><h1 id="CocoaPodså¯¹New-build-systemæ°´åœŸä¸æœ"><a href="#CocoaPodså¯¹New-build-systemæ°´åœŸä¸æœ" class="headerlink" title="CocoaPodså¯¹New build systemæ°´åœŸä¸æœ"></a>CocoaPodså¯¹New build systemæ°´åœŸä¸æœ</h1><p>å¦‚æœæ‚¨ä½¿ç”¨CocoaPodsä¸æ–°çš„Xcodeæ„å»ºç³»ç»Ÿ(New build system)ä¸€èµ·ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¼€å‘åº“ï¼Œä¼šæœ‰ä¸€ä¸ªå¯¹æ–°æ‰‹æä¸å‹å¥½çš„<strong>BUG</strong> â€”â€” å³Xcodeåœ¨æ„å»ºpodsåº“æ—¶ä¸ä¼šè·å–ä¸Šæ¬¡<em>pod install</em>ä¹‹åä¿®æ”¹çš„æœ€æ–°ä»£ç ã€‚</p><p>å‚è§<a href="https://openradar.appspot.com/41126633" target="_blank" rel="noopener">radar 41126633</a>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å‘è¿‡ç¨‹ä¸­æ¯æ¬¡ä¿®æ”¹äº†åº“ä»£ç ï¼Œä½ å°±è¦é‡æ–°clean -&gt; build -&gt; runï¼Œå¦åˆ™è·‘çš„è¿˜æ˜¯æ—§ä»£ç ï¼</p><p>â€œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦åº“å¼€å‘ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦ç»„ä»¶åŒ–å¼€å‘ï¼Œè€Œä¸”ä½ çš„Xcodeåˆšå¥½å‡çº§åˆ°äº†10ä»¥ä¸Šæœ‰äº†æ–°çš„ç¼–è¯‘ç³»ç»Ÿï¼Œé‚£ä¹ˆä½ æ€»æ˜¯ä¼šè«åå…¶å¦™è¸©è¿›è¿™ä¸ªæ€ªå‘ï¼å…¶æ¬¡ï¼Œæ¯æ¬¡cleanä¹‹åé‡æ–°ç¼–è¯‘ï¼Œå¯¹äºæ¯”è¾ƒå¤§çš„é¡¹ç›®å°±è¦æ¶ˆè€—ä¸€å †æ—¶é—´ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…ä¹Ÿæ˜¯æ‰“æ–­äº†å¼€å‘çš„æ€è·¯ï¼Œè¿™æ˜¯éå¸¸ä¸¥é‡çš„é—®é¢˜å•Šï¼â€</p><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ”¹å›æ—§çš„build systemï¼š</p><p><strong>File Â» Workspace Settings Â» Use Legacy Build</strong>.</p><blockquote><p>Tips: è®°å¾—åœ¨æ¯æ¬¡<em>pod install</em>ä¹‹åï¼Œéƒ½å¾—å»æ”¹ï¼Œå› ä¸ºxcworkspaceé»˜è®¤ä¹Ÿä¼šä½¿ç”¨æ–°ç¼–è¯‘ç³»ç»Ÿï¼</p></blockquote><h1 id="ä¸ºä»€ä¹ˆæ°´åœŸä¸æœï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ°´åœŸä¸æœï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ°´åœŸä¸æœï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ°´åœŸä¸æœï¼Ÿ</h1><p>é•¿è¯çŸ­è¯´ï¼šçœ‹ä¸€ä¸‹é¡¹ç›®çš„<strong>Build Phases</strong>ã€‚ æœ‰ä¸ª<strong>Embed Pods Frameworks</strong>ï¼Œå¯å°†æ„å»ºçš„æ¡†æ¶å¤åˆ¶åˆ°é¡¹ç›®ä¸­ã€‚ æ­¤åŠŸèƒ½ä½¿ç”¨ä¸€ç§ç§°ä¸º<em>Input/Output files</em>çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä»…åœ¨å—å½±å“çš„æ–‡ä»¶å·²æ›´æ”¹æ—¶æ‰è¿è¡Œè„šæœ¬ã€‚</p><p><a href="https://imgchr.com/i/8SknEt" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2020/03/09/8SknEt.md.png" alt="8SknEt.md.png"></a></p><p>è¿™ä¼¼ä¹åœ¨æ–°çš„æ„å»ºç³»ç»Ÿä¸­è¢«æ‰“ç ´äº†ï¼Œçœ‹çœ‹ <a href="https://openradar.appspot.com/41126633" target="_blank" rel="noopener">Xcode bug</a> æ‰€è¯´çš„ã€‚</p><h1 id="æ›´å¥½çš„è§£å†³åŠæ³•"><a href="#æ›´å¥½çš„è§£å†³åŠæ³•" class="headerlink" title="æ›´å¥½çš„è§£å†³åŠæ³•"></a>æ›´å¥½çš„è§£å†³åŠæ³•</h1><ol><li><p>å‡çº§ä½ çš„CocoaPodsç‰ˆæœ¬è‡³&gt;=1.6ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem update cocoapods</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åï¼Œæ‚¨å¯ä»¥å°†<em>installation option</em>ï¼ˆå®‰è£…é€‰é¡¹ï¼‰æ·»åŠ åˆ°<strong>Podfile</strong>ä¸­ï¼Œä»¥ç¦ç”¨<em>Input/Output files</em>çš„ä½¿ç”¨ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">install! <span class="string">'cocoapods'</span>, <span class="symbol">:disable_input_output_paths</span> =&gt; <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'HelloPod_Example'</span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>ç°åœ¨ï¼Œå½“æ‚¨å†æ¬¡è¿è¡Œpod installæ—¶ï¼Œæ„å»ºé˜¶æ®µå°†ä¸å†ä½¿ç”¨è¾“å…¥/è¾“å‡ºæ–‡ä»¶ï¼ŒCocoapodsè„šæœ¬å°†å§‹ç»ˆè¿è¡Œï¼Œä»¥ä¿è¯æ‚¨çš„åº“ä»£ç å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> CocoaPods </tag>
            
            <tag> NewBuildSystem </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³scrollViewä¸­æ¼äººçš„æ‰‹åŠ¿å†²çª</title>
      <link href="/%E8%A7%A3%E5%86%B3scrollView%E4%B8%AD%E6%81%BC%E4%BA%BA%E7%9A%84%E6%89%8B%E5%8A%BF%E5%86%B2%E7%AA%81.html"/>
      <url>/%E8%A7%A3%E5%86%B3scrollView%E4%B8%AD%E6%81%BC%E4%BA%BA%E7%9A%84%E6%89%8B%E5%8A%BF%E5%86%B2%E7%AA%81.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>å¼€å‘ä¸€ä¸ªç•Œé¢è¾ƒä¸ºå¤æ‚çš„appï¼Œæˆ‘ä»¬åŠ¿å¿…ä¼šå‡ºç°åœ¨scrollviewæˆ–è€…tableviewä¸ŠåŠ ä¸ŠæŒ‰é’®æˆ–è€…æ‰‹åŠ¿ï¼ŒBut..</p><p>Cellä¸­Buttonç‚¹å‡»é«˜äº®åé¦ˆä¸ºä½•æœ‰é˜»æ»ï¼Ÿ</p><p>åˆæ˜¯ä»€ä¹ˆé˜»æŒ¡äº†æˆ‘tableviewçš„æ»‘åŠ¨ï¼ˆæ»‘åŠ¨å¤±æ•ˆï¼‰ï¼Ÿ</p></blockquote><a id="more"></a><h1 id="ScrollViewæ‰‹åŠ¿å¤„ç†åŸç†"><a href="#ScrollViewæ‰‹åŠ¿å¤„ç†åŸç†" class="headerlink" title="ScrollViewæ‰‹åŠ¿å¤„ç†åŸç†"></a>ScrollViewæ‰‹åŠ¿å¤„ç†åŸç†</h1><p>ä¸€æ¬¾ä¼˜ç§€çš„äº§å“åŠ¿å¿…è¦æœ‰ä¼˜ç§€çš„ç‚¹å‡»åé¦ˆï¼Œä½†æ˜¯ä¸ºä½•ä½ åšçš„åˆ—è¡¨ <strong>å¿«é€Ÿç‚¹å‡»äº†cellä¸Šçš„æŒ‰é’®æ²¡æœ‰é«˜äº®ï¼Œç‚¹å‡»æ—¶é—´å»¶é•¿äº†æ‰æœ‰æ•ˆæœï¼ï¼Ÿ</strong></p><blockquote><p>UIScrollViewåŸç†ï¼Œä»¥æ—¶é—´ä¸ºè½´çº¿ï¼š</p><p>ä»ä½ çš„æ‰‹æŒ‡touchå±å¹•å¼€å§‹ï¼ŒscrollViewå¼€å§‹ä¸€ä¸ªtimerï¼Œå¦‚æœï¼š</p><ol><li><p>150mså†…å¦‚æœä½ çš„æ‰‹æŒ‡æ²¡æœ‰ä»»ä½•åŠ¨ä½œï¼Œæ¶ˆæ¯å°±ä¼šä¼ ç»™subViewã€‚</p></li><li><p>150mså†…æ‰‹æŒ‡æœ‰æ˜æ˜¾çš„æ»‘åŠ¨ï¼ˆä¸€ä¸ªswipeåŠ¨ä½œï¼‰ï¼ŒscrollViewå°±ä¼šæ»šåŠ¨ï¼Œæ¶ˆæ¯ä¸ä¼šä¼ ç»™subViewã€‚</p></li><li><p>150mså†…æ‰‹æŒ‡æ²¡æœ‰æ»‘åŠ¨ï¼ŒscrollViewå°†æ¶ˆæ¯ä¼ ç»™subViewï¼Œä½†æ˜¯ä¹‹åæ‰‹æŒ‡å¼€å§‹æ»‘åŠ¨ï¼ŒscrollViewä¼ é€touchesCancelledæ¶ˆæ¯ç»™subViewï¼Œç„¶åå¼€å§‹æ»šåŠ¨ã€‚</p></li></ol><p>UIScrollViewæœ‰ä¸€ä¸ªBOOLç±»å‹çš„<code>tracking</code>å±æ€§ï¼Œç”¨æ¥è¿”å›ç”¨æˆ·æ˜¯å¦å·²ç»è§¦åŠå†…å®¹å¹¶æ‰“ç®—å¼€å§‹æ»šåŠ¨,å½“æ‰‹æŒ‡è§¦æ‘¸åˆ°UIScrollViewå†…å®¹çš„ä¸€ç¬é—´ï¼Œä¼šäº§ç”Ÿä¸‹é¢çš„åŠ¨ä½œï¼š</p><p>æ‹¦æˆªè§¦æ‘¸äº‹ä»¶</p><p>trackingå±æ€§å˜ä¸ºYES</p><p>ä¸€ä¸ªå†…ç½®çš„è®¡æ—¶å™¨å¼€å§‹ç”Ÿæ•ˆï¼Œç”¨æ¥ç›‘æ§åœ¨æçŸ­çš„äº‹ä»¶é—´éš”å†…æ˜¯å¦å‘ç”Ÿäº†æ‰‹æŒ‡ç§»åŠ¨</p><ul><li><p>å½“æ£€æµ‹åˆ°æ—¶é—´é—´éš”å†…æ‰‹æŒ‡å‘ç”Ÿäº†ç§»åŠ¨ï¼ŒUIScrollViewè‡ªå·±è§¦å‘æ»šåŠ¨ï¼Œtrackingå±æ€§å˜ä¸ºNOï¼Œæ‰‹æŒ‡è§¦æ‘¸ä¸‹å³ä½¿æœ‰(å¯ä»¥å“åº”è§¦æ‘¸äº‹ä»¶çš„)å†…éƒ¨æ§ä»¶ä¹Ÿä¸ä¼šå†å“åº”è§¦æ‘¸äº‹ä»¶ã€‚</p></li><li><p>å½“æ£€æµ‹åˆ°æ—¶é—´é—´éš”å†…æ‰‹æŒ‡æ²¡æœ‰ç§»åŠ¨ï¼Œtrackingå±æ€§ä¿æŒYESï¼Œæ‰‹æŒ‡è§¦æ‘¸ä¸‹å¦‚æœæœ‰(å¯ä»¥å“åº”è§¦æ‘¸äº‹ä»¶çš„)å†…éƒ¨æ§ä»¶ï¼Œåˆ™å°†è§¦æ‘¸äº‹ä»¶ä¼ é€’ç»™æ§ä»¶è¿›è¡Œå¤„ç†ã€‚</p></li></ul></blockquote><p>å½“ä½ æ‰‹æŒ‡æ”¾åœ¨æŒ‰é’®ä¸Šï¼Œç»´æŒ150msï¼Œæ‰ä¼šè§¦å‘UIButtonçš„è§¦æ‘¸äº‹ä»¶ï¼</p><h3 id="delaysContentTouches"><a href="#delaysContentTouches" class="headerlink" title="delaysContentTouches"></a>delaysContentTouches</h3><p>ä¸è¿‡ä¸Šé¢çš„å·¥ä½œåŸç†å…¶å®æœ‰ä¸€ä¸ªå±æ€§å¼€å…³æ¥æ§åˆ¶ï¼š<code>delaysContentTouches</code>ï¼ˆé»˜è®¤trueï¼‰</p><p>åªè¦å°†scrollviewçš„è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºfalseï¼Œæ»šåŠ¨è§†å›¾å°†ä¼šç¬¬ä¸€æ—¶é—´å¤„ç†å“åº”è€…é“¾çš„æ‰‹åŠ¿ä¼ é€’ï¼</p><p>ï¼ˆæŒ‰é’®ä¸€ç‚¹å³äº®ï½ï¼‰</p><p>è¿™æ—¶å°±ä¼šç«‹åˆ»æ‰§è¡Œ<code>touchesShouldBegin: withEvent: inContentView:</code>æ–¹æ³•ï¼</p><p>ï¼ˆè¿™ä¸ªæ–¹æ³•æ˜¯æœ€å…ˆæ¥æ”¶åˆ°æ»‘åŠ¨äº‹ä»¶çš„ï¼Œä¼˜å…ˆäºbuttonçš„</p><p><code>UIControlEventTouchDown</code>ï¼Œä»¥åŠ<code>- (void)touchesCancelled:(NSSet*)touches withEvent:(UIEvent*)eventï¼‰</code></p><blockquote><p>å¦‚æœè®¾ç½®ä¸ºtrueï¼Œtouchäº‹ä»¶æ²¿ç€æ¶ˆæ¯å“åº”é“¾ä¼ é€’;</p></blockquote><blockquote><p>å¦‚æœè®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºUIScrollViewæ¥æ”¶è¿™ä¸ªæ»šåŠ¨äº‹ä»¶ï¼Œä¸å¿…æ²¿ç€æ¶ˆæ¯å“åº”é“¾ä¼ é€’äº†ã€‚</p></blockquote><h3 id="touchesShouldCancelled-withEvent"><a href="#touchesShouldCancelled-withEvent" class="headerlink" title="touchesShouldCancelled:withEvent:"></a>touchesShouldCancelled:withEvent:</h3><p>å½“æˆ‘ä»¬æ­£åœ¨è§¦æ‘¸å±å¹•çš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°äº†ä½ç”µé‡ã€æœ‰ç”µè¯å‘¼å…¥ç­‰ç­‰è¿™æ ·çš„ç³»ç»Ÿäº‹ä»¶æ—¶å€™ï¼Œä½ç”µé‡æˆ–è€…ç”µè¯çš„çª—å£ä¼šç½®ä¸ºå‰å°ï¼Œè¿™ä¸ªæ—¶å€™touchesCancelledæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚è¿™å¤§å¤šæ•°æ˜¯ç”±iOSç³»ç»Ÿå‘å‡ºçš„ä¸€äº›äº‹ä»¶ï¼Œå¯¼è‡´è§¦æ‘¸äº‹ä»¶çš„ä¸­æ–­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç›´æ¥è°ƒç”¨touchesEndå³å¯ã€‚</p><blockquote><p>å¦‚æœè¿”å›true  ï¼Œ(ç³»ç»Ÿé»˜è®¤)æ˜¯å…è®¸UIScrollViewï¼ŒæŒ‰ç…§æ¶ˆæ¯å“åº”é“¾å‘å­è§†å›¾ä¼ é€’æ¶ˆæ¯çš„</p></blockquote><blockquote><p>å¦‚æœè¿”å›falseï¼ŒUIScrollView,å°±æ¥æ”¶ä¸åˆ°æ»‘åŠ¨äº‹ä»¶äº†ã€‚</p></blockquote><h3 id="canCancelContentTouches"><a href="#canCancelContentTouches" class="headerlink" title="canCancelContentTouches"></a>canCancelContentTouches</h3><p>è¿™ä¸ªBoolç±»å‹çš„å€¼æ§åˆ¶contentviewé‡Œçš„è§¦æ‘¸æ˜¯å¦æ€»èƒ½å¼•å‘è·Ÿè¸ª(tracking)ã€‚ï¼ˆé»˜è®¤trueï¼‰</p><p>å¦‚æœè®¾ç½®ä¸ºfalseï¼Œè¿™æ¶ˆæ¯ä¸€æ—¦ä¼ é€’ç»™subViewï¼Œè¿™scrolläº‹ä»¶ä¸ä¼šå†å‘ç”Ÿã€‚</p><blockquote><p>å¦‚æœå±æ€§å€¼ä¸ºtrueå¹¶ä¸”è·Ÿè¸ªåˆ°æ‰‹æŒ‡æ­£è§¦æ‘¸åˆ°ä¸€ä¸ªå†…å®¹æ§ä»¶ï¼Œè¿™æ—¶å¦‚æœç”¨æˆ·æ‹–åŠ¨æ‰‹æŒ‡çš„è·ç¦»è¶³å¤Ÿäº§ç”Ÿæ»šåŠ¨ï¼Œé‚£ä¹ˆå†…å®¹æ§ä»¶å°†æ”¶åˆ°ä¸€ä¸ª<code>touchesCancelled:withEvent:</code>æ¶ˆæ¯ï¼Œè€Œscrollviewå°†è¿™æ¬¡è§¦æ‘¸ä½œä¸ºæ»šåŠ¨æ¥å¤„ç†ã€‚</p></blockquote><blockquote><p>å¦‚æœå€¼ä¸ºfalseï¼Œä¸€æ—¦contentviewå¼€å§‹è·Ÿè¸ª(tracking==YES)ï¼Œåˆ™æ— è®ºæ‰‹æŒ‡æ˜¯å¦ç§»åŠ¨ï¼ŒscrollViewéƒ½ä¸ä¼šæ»šåŠ¨ã€‚</p></blockquote><h1 id="å°†æŒ‰é’®ç‚¹å‡»åé¦ˆå‡ºæ¥"><a href="#å°†æŒ‰é’®ç‚¹å‡»åé¦ˆå‡ºæ¥" class="headerlink" title="å°†æŒ‰é’®ç‚¹å‡»åé¦ˆå‡ºæ¥"></a>å°†æŒ‰é’®ç‚¹å‡»åé¦ˆå‡ºæ¥</h1><p>ä¸ºäº†ä½¿æˆ‘çš„cellæˆ–è€…å­æ§ä»¶ä¸Šçš„æŒ‰é’®æœ‰ç‚¹å‡»æ•ˆæœï¼Œå°† <code>delaysContentTouches</code>è®¾ç½®ä¸ºfalseï¼Œæˆ‘çš„æŒ‰é’®é‡è·äº†ç¬¬ä¸€æ—¶é—´çš„åé¦ˆæ•ˆæœã€‚</p><p>å½“<code>delaysContentTouches</code>è®¾ç½®ä¸ºfalseä¹‹åï¼Œscrollviewçš„æ»‘åŠ¨æœ‰æ—¶ä¼šå¤±æ•ˆï¼Œ æˆ‘çš„æ‰‹æŒ‡ç»è¿‡äº†buttonï¼ˆæœ‰ç‚¹å‡»é«˜äº®æ•ˆæœï¼‰å†ç§»å¼€ï¼Œscrollviewä¸ä¼šæ¥æ”¶æ»‘åŠ¨äº‹ä»¶ï¼ŒUIButtoné˜»æŒ¡æ‰äº†æˆ‘çš„æ»‘åŠ¨æ‰‹åŠ¿ï¼</p><p>å¦‚æœåŒæ—¶å†ä¸»åŠ¨ä¿®æ”¹<code>canCancelContentTouches</code>è¿™ä¸ªå±æ€§æ”¹ä¸ºtrueï¼Œæ»‘åŠ¨æ‰‹åŠ¿ä»ç„¶ä¼šè¢«é˜»æŒ¡ğŸ˜‚ï¼ˆè¿™ä¸ªå±æ€§åŸºæœ¬æ²¡æœ‰ç”¨åˆ°è¿‡ï¼Œä½†æ˜¯å…ˆè®°ä¸€ä¸‹ï¼‰ã€‚</p><h1 id="ä¿®å¤æ»‘åŠ¨æ‰‹åŠ¿"><a href="#ä¿®å¤æ»‘åŠ¨æ‰‹åŠ¿" class="headerlink" title="ä¿®å¤æ»‘åŠ¨æ‰‹åŠ¿"></a>ä¿®å¤æ»‘åŠ¨æ‰‹åŠ¿</h1><p><strong>æ•ˆæœï¼š</strong>å½“å°†æ‰‹æŒ‡æŒ‰ä¸‹æ—¶ï¼Œcellä¸Šçš„æŒ‰é’®ä¼šæ›´æ”¹é¢œè‰²ï¼Œè¿™ä¼šæä¾›è§†è§‰åé¦ˆï¼Œä»¥ç¡®è®¤æ‚¨æŠ¬èµ·æ‰‹æŒ‡æ—¶å°†æ¿€æ´»å“ªä¸ªæŒ‰é’®ã€‚æ¥ç€ç”¨æˆ·å¦‚æœå°†æ‰‹æŒ‡ä»æŒ‰é’®ä¸Šæ‹–åŠ¨ï¼Œåˆ™åˆ’å‡ºè¯¥æŒ‰é’®æ—¶ï¼Œè§¦æ‘¸è¿™ä¸ªäº‹ä»¶å°†è¢«å–æ¶ˆï¼Œå¹¶ä¸”è¯¥æŒ‰é’®å–æ¶ˆé«˜äº®æ˜¾ç¤ºï¼Œå°†ç”¨æˆ·æ‰‹åŠ¿å˜ä¸ºæ»‘åŠ¨æ»šåŠ¨scrollviewã€‚</p><p>è¿™æ—¶æˆ‘ä»¬çš„æŠ€å·§æ˜¯ï¼Œé‡å†™ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œ<code>touchesShouldCancel(in:)</code> ï¼Œè‡ªå·±å†³å®šæ˜¯å¦å…è®¸æ»šåŠ¨è§†å›¾å–æ¶ˆæ§ä»¶ä¸­çš„è§¦æ‘¸ï¼</p><p>è¿™é‡Œå®ç°äº†ä¸€ä¸ªscrollView, tableView, collectionViewçš„çˆ¶æ§ä»¶ï¼Œä»–ä»¬å¯ä»¥é˜²æ­¢UIButtonæˆ–è€…æŸäº›ä¸åº”è¯¥åƒæ‰æ‰‹åŠ¿çš„æ§ä»¶ä½œå‡ºä¸å½“çš„è¡Œä¸ºï¼ˆä½†æ˜¯æœ€å¥½è¿˜æ˜¯ä¿ç•™UITextInput, UISlider, ä»¥åŠUISwitché˜»æŒ¡æ‰‹åŠ¿çš„æƒåˆ©ï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="comment">// These let you start a touch on a control that's inside a scroll view,</span></span><br><span class="line"><span class="comment">// and then if you start dragging, it cancels the touch on the button</span></span><br><span class="line"><span class="comment">// and lets you scroll instead. Without these scroll view subclasses,</span></span><br><span class="line"><span class="comment">// controls in scroll views will eat touches that start in them, which</span></span><br><span class="line"><span class="comment">// prevents scrolling and makes the app feel broken.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The UITextInput exception is for cases where you have a text field</span></span><br><span class="line"><span class="comment">// or a text view in a scroll view. If you press and hold there, you want</span></span><br><span class="line"><span class="comment">// to get the text editing magnifier cursor, instead of canceling the</span></span><br><span class="line"><span class="comment">// touch in the text input element.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Ditto for UISlider and UISwitch: if the table view eats the drag gesture,</span></span><br><span class="line"><span class="comment">// they feel broken. Feel free to add your own exceptions if you have custom</span></span><br><span class="line"><span class="comment">// controls that require swiping or dragging to function.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ControlContainableScrollView</span>: <span class="title">UIScrollView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesShouldCancel</span><span class="params">(<span class="keyword">in</span> view: UIView)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> view <span class="keyword">is</span> <span class="type">UIControl</span></span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UITextInput</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISlider</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISwitch</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.touchesShouldCancel(<span class="keyword">in</span>: view)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ControlContainableTableView</span>: <span class="title">UITableView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesShouldCancel</span><span class="params">(<span class="keyword">in</span> view: UIView)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> view <span class="keyword">is</span> <span class="type">UIControl</span></span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UITextInput</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISlider</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISwitch</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.touchesShouldCancel(<span class="keyword">in</span>: view)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ControlContainableCollectionView</span>: <span class="title">UICollectionView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesShouldCancel</span><span class="params">(<span class="keyword">in</span> view: UIView)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> view <span class="keyword">is</span> <span class="type">UIControl</span></span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UITextInput</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISlider</span>)</span><br><span class="line">            &amp;&amp; !(view <span class="keyword">is</span> <span class="type">UISwitch</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.touchesShouldCancel(<span class="keyword">in</span>: view)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦ä½¿ç”¨äº†è¿™ä¸ªä¸¤ä¸ªæŠ€å·§ï¼Œä½ èƒ½ä¿ç•™scrollviewä¸Šäº¤äº’æ§ä»¶çš„è‰¯å¥½ç‚¹å‡»åé¦ˆï¼Œåˆèƒ½åƒåŸç”Ÿtableviewä¸€æ ·è‡ªç„¶çš„æ»‘åŠ¨å–æ¶ˆç‚¹å‡»cellçš„é«˜äº®å¹¶ä¸”å˜æˆæ»šåŠ¨scrollviewï¼Œå¸¦æ¥æ›´è‡ªç„¶æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå“‡ï¼ï¼ï¼</p><h1 id="UIGestureRecognizerDelegateè§£å†³scrollViewåµŒå¥—é—®é¢˜"><a href="#UIGestureRecognizerDelegateè§£å†³scrollViewåµŒå¥—é—®é¢˜" class="headerlink" title="UIGestureRecognizerDelegateè§£å†³scrollViewåµŒå¥—é—®é¢˜"></a>UIGestureRecognizerDelegateè§£å†³scrollViewåµŒå¥—é—®é¢˜</h1><p>â€”â€” å½“ä½ éœ€è¦åœ¨scrollViewä¸ŠåŠ ä¸Šæ»‘åŠ¨æ‰‹åŠ¿çš„æ—¶å€™ï¼Œæˆ–è€…é‡åˆ°scrollViewåµŒå¥—scrollViewçš„æ—¶å€™ã€‚</p><p><code>*gestureRecognizer(_:shouldRecognizeSimultaneouslyWith:)*</code></p><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©æ‰‹åŠ¿ç»§ç»­å‘ä¸‹ä¸€ä¸ªå“åº”è€…ä¼ é€’ï¼Œæ‰‹åŠ¿åŠ åœ¨ScrollViewæˆ–è€…tableViewä¸Šä¹Ÿ<strong>ä¸ä¼š</strong>æœ‰å†²çªï¼Œä¸éœ€è¦é€šè¿‡offsetå·®å€¼å»è®¡ç®—æ»‘åŠ¨æ–¹å‘ï¼Œæ•ˆæœç›¸å½“å®Œç¾ã€‚</p><p><strong>æ¯”æ–¹æœ‰è¿™æ ·ä¸€ä¸ªæ™®é€šéœ€æ±‚ï¼š</strong></p><ol><li><p>ä¸Šæ»‘çš„æ—¶å€™ï¼Œå…ˆä¸è®©å­scrollViewæ»‘åŠ¨ï¼ˆæ›´æ”¹contentOffsetYä¸º0ï¼‰ï¼Œè€Œæ˜¯éšè—<code>topView</code>å¤´éƒ¨å†…å®¹æ§ä»¶ï¼Œå†è®©å­scrollViewå¼€å§‹æ»‘åŠ¨</p></li><li><p>ä¸‹æ»‘çš„æ—¶å€™ï¼Œç­‰å­scrollViewæ»‘åˆ°æœ€ä¸Šæ–¹ä¹‹åï¼ˆcontentOffsetYä¸º0ï¼‰ï¼Œå†å…è®¸çˆ¶ScrollViewæ»‘åŠ¨ï¼Œæ»šåŠ¨åˆ°<code>topView</code>å¤´éƒ¨æ§ä»¶é¡¶éƒ¨</p></li></ol><p><strong>æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š</strong></p><ol><li>åˆ›å»ºUIScrollViewçš„å­ç±»ï¼Œå®ç°ä»£ç†UIGestureRecognizerDelegateçš„<code>gestureRecognizer(_:shouldRecognizeSimultaneouslyWith:)</code>æ–¹æ³•ï¼›è¿”å›trueï¼Œè®©æ»‘åŠ¨äº‹ä»¶å¯ä»¥å‘çˆ¶Viewä¼ é€’ï¼š</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyScrollView</span>: <span class="title">UIScrollView</span>, <span class="title">UIGestureRecognizerDelegate</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> isSimultaneousGesture: bool = <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gestureRecognizer</span><span class="params">(<span class="number">_</span> gestureRecognizer: UIGestureRecognizer, shouldRecognizeSimultaneouslyWith otherGestureRecognizer: UIGestureRecognizer)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>.isSimultaneousGesture</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®ç°ä»£ç†æ–¹æ³•ï¼šï¼ˆä¾‹å­ï¼‰</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CollisionViewController</span>: <span class="title">UIScrollViewDelegate</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scrollViewWillBeginDragging</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> scrollView == <span class="keyword">self</span>.myScrollView &#123;</span><br><span class="line">      <span class="comment">// è®°å½•å­scrollviewçš„åˆå§‹yè½´ä½ç§»</span></span><br><span class="line">_lastOffsetY = <span class="keyword">self</span>.myScrollView.contentOffset.y</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scrollViewDidScroll</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> scrollView == <span class="keyword">self</span>.myScrollView &#123;</span><br><span class="line">      <span class="comment">// anchoråæ­£å°±æ˜¯topViewçš„åº•éƒ¨è·ç¦»ï¼Œè®¾ä¸ºä¸€ä¸ªäº§ç”Ÿå½¢å˜çš„é”šç‚¹</span></span><br><span class="line"><span class="keyword">let</span> anchorY = &lt;topView&gt;.bottom</span><br><span class="line">      </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">self</span>.scrollView.contentOffset.y &gt; _lastOffsetY &#123;</span><br><span class="line"><span class="comment">// scrollViewä¸‹æ»‘</span></span><br><span class="line"><span class="keyword">if</span> superContainerScrollView!.contentOffset.y &lt;= anchorY &#123;</span><br><span class="line"><span class="keyword">self</span>.scrollView.contentOffset.y = <span class="number">0</span></span><br><span class="line">          superContainerScrollView?.setContentOffset(<span class="type">CGPoint</span>(<span class="number">0</span>, anchorY) animated: <span class="literal">true</span>)</span><br><span class="line">          <span class="comment">//è®©æ‰‹åŠ¿é€ä¼ å±æ€§å˜ä¸ºfalse</span></span><br><span class="line">          scrollView.isSimultaneousGesture = <span class="literal">false</span></span><br><span class="line">          <span class="comment">//è¿™é‡Œå¯ä»¥åšéšè—navigationBarçš„æ“ä½œ..</span></span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.scrollView.contentOffset.y &lt; _lastOffsetY &#123;</span><br><span class="line"><span class="comment">// scrollViewä¸Šæ»‘</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">self</span>.scrollView.contentOffset.y &lt; <span class="number">0</span> &#123;</span><br><span class="line">          <span class="keyword">self</span>.scrollView.contentOffset.y = <span class="number">0</span></span><br><span class="line">superContainerScrollView?.setContentOffset(<span class="type">CGPoint</span>(<span class="number">0</span>, <span class="number">0</span>) animated: <span class="literal">true</span>)</span><br><span class="line">          <span class="comment">//è®©æ‰‹åŠ¿é€ä¼ å±æ€§å˜ä¸ºtrue</span></span><br><span class="line">          scrollView.isSimultaneousGesture = <span class="literal">true</span></span><br><span class="line">          <span class="comment">//è¿™é‡Œå¯ä»¥åšæ˜¾ç¤ºnavigationBarçš„æ“ä½œ..</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> å¼€å‘ä¹‹æœ¯ </tag>
            
            <tag> ScrollView </tag>
            
            <tag> TableView </tag>
            
            <tag> æ‰‹åŠ¿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸æ­¢é…ç½®sshå®ç°Sourcetreeå¯†é’¥è®¿é—®è¿œç¨‹ä»“åº“</title>
      <link href="/%E4%B8%8D%E6%AD%A2%E9%85%8D%E7%BD%AEssh%E5%AE%9E%E7%8E%B0Sourcetree%E5%AF%86%E9%92%A5%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93.html"/>
      <url>/%E4%B8%8D%E6%AD%A2%E9%85%8D%E7%BD%AEssh%E5%AE%9E%E7%8E%B0Sourcetree%E5%AF%86%E9%92%A5%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>æ¯æ¬¡æ¨æ‹‰åˆå¹¶ä»£ç åˆ°è¿œç¨‹ä»“åº“éƒ½éœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼Œé‚£ä¹Ÿå¤ªæ…¢äº†å¤ªç³—äº†å§ï¼Ÿ</p><p>é…ç½®å¥½äº†sshç§é’¥ï¼Œä½†æ˜¯ä¸ºä½•æŠ¥é”™port 22: Connection refusedå‘¢ï¼Ÿ</p><p>ç»ˆäºå…å¯†æ“ä½œäº†ï¼Œå’‹ç”µè„‘é‡å¯åˆä¸ä¸å¥½ä½¿äº†ï¼Ÿ</p></blockquote><a id="more"></a><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å›¢é˜Ÿå®æ–½äº†ç»„ä»¶åŒ–å¼€å‘ï¼Œé¡¹ç›®åˆ†æˆå¤šä¸ªç»„ä»¶ã€‚</p><p>éš¾ä»¥é¿å…çš„ä¼šé¢‘ç¹ä½¿ç”¨podåŠè¿œç¨‹ä»“åº“æ“ä½œï¼Œæ¯å¤©åæ¥ä½åŒäº‹åœ¨ç–¯ç‹‚è¾“å‡ºï¼Œä¸€ä¸ç•™ç¥é¡¹ç›®gitå°±å‡ åä¸ªæ›´æ–°ï¼Œå¦‚æœæ¯æ¬¡pull/rebase/merge/push/ä»£ç éƒ½éœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼Œé‚£ç»å¯¹1000%å½±å“å¼€å‘è¿›åº¦ã€‚</p><h1 id="é…ç½®ssh"><a href="#é…ç½®ssh" class="headerlink" title="é…ç½®ssh"></a>é…ç½®ssh</h1><blockquote><p>â€œSSH ä¸º Secure Shell çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯ç›®å‰è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚</p></blockquote><p>å‡ ä¹æ¯ä¸€ä¸ªè¿œç¨‹ä»“åº“æœåŠ¡å•†ï¼ˆgithub, gitlab, bitbucketâ€¦ï¼‰éƒ½æœ‰å¦‚ä½•ç”Ÿæˆä»¥åŠå°†å¯†é’¥é…ç½®åˆ°è¿œç¨‹ä»“åº“çš„<a href="https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh" target="_blank" rel="noopener">æ•™ç¨‹</a>ï¼Œè¿™é‡Œç®€å•çœ‹çœ‹æ­¥éª¤</p><h3 id="å¸¸è§„æ“ä½œ"><a href="#å¸¸è§„æ“ä½œ" class="headerlink" title="å¸¸è§„æ“ä½œ"></a>å¸¸è§„æ“ä½œ</h3><ul><li><p>ç”Ÿæˆæ–°çš„ssh key</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C "your_email@example.com"</span><br></pre></td></tr></table></figure></li><li><p>æˆ–æŸ¥çœ‹å·²å­˜åœ¨çš„key</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al ~/.ssh</span><br></pre></td></tr></table></figure></li><li><p>å°†æ‚¨çš„SSHç§é’¥æ·»åŠ åˆ°ssh-agentï¼ˆè¯¥agentä¸ºæ‚¨å®ç°èº«ä»½éªŒè¯æ“ä½œå“¦ï¼‰å¹¶å°†å¯†ç çŸ­è¯­å­˜å‚¨åœ¨Macé’¥åŒ™ä¸²ä¸­</p></li><li><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -K ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></li><li><p>å°†sshå¯†é’¥å¤åˆ¶åˆ°å‰ªè´´æ¿åï¼Œç²˜åˆ°è¿œç¨‹ä»“åº“çš„é…ç½®ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pbcopy &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure></li></ul><blockquote><p><code>-K</code>é€‰é¡¹æ˜¯Appleçš„æ ‡å‡†ç‰ˆæœ¬<code>ssh-add</code>ï¼Œå½“æ‚¨å°†sshå¯†é’¥æ·»åŠ åˆ°ssh-agentæ—¶ï¼Œå®ƒå°†å¯†ç çŸ­è¯­å­˜å‚¨åœ¨æ‚¨çš„é’¥åŒ™ä¸²ä¸­</p></blockquote><h3 id="æŠ¥é”™ï¼šssh-connect-to-host-gitlab-com-port-22-Connection-refused"><a href="#æŠ¥é”™ï¼šssh-connect-to-host-gitlab-com-port-22-Connection-refused" class="headerlink" title="æŠ¥é”™ï¼šssh: connect to host gitlab.com port 22: Connection refused"></a>æŠ¥é”™ï¼šssh: connect to host gitlab.com port 22: Connection refused</h3><p>ä½ å·²ç»å°†ç§é’¥æ·»åŠ åˆ°äº†ä»£ç†å’Œé’¥åŒ™ä¸²ï¼Œè¿œç¨‹ä¹Ÿé…ç½®å¥½äº†ï¼Œç„¶é¹…ä¸ç®¡ç»ˆç«¯è¿˜æ˜¯sourcetreeæ“ä½œè¿˜æ˜¯ä¼šæŠ¥é”™ã€‚</p><ul><li><p>æµ‹è¯•é“¾æ¥ï¼Œå¦‚ä¸‹æ˜¯å‡å¦‚ä½ æƒ³é…ç½®å¤šä¸ªå¹³å°.. æ­¤æ—¶ä½ è¾“å…¥å“ªä¸€ä¸ªéƒ½ä¼šæŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T bitbucket.org</span><br><span class="line">ssh -T 192.160.2.xxx   //å·¥ä½œçš„ç§æœ‰è¿œç¨‹ä»“åº“</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯macOS Sierra 10.12.2æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œéœ€è¦<code>~/.ssh/config</code>æ–‡ä»¶ä»¥å°†å¯†é’¥è‡ªåŠ¨åŠ è½½åˆ°ssh-agentä¸­ï¼Œå¹¶å°†å¯†ç çŸ­è¯­å­˜å‚¨åœ¨å¯†é’¥é“¾ä¸­</p></blockquote></li></ul><p>ä¹Ÿå°±æ˜¯è¯´ssh-addè¿˜ä¸å¤Ÿï¼Œæˆ‘è¿˜éœ€è¦é…ç½®sshçš„configæ–‡ä»¶ï¼Œconfigæ–‡ä»¶æ¶‰åŠåˆ°å¾ˆå¤šä¸åŒå­—æ®µæœ‰ä¸åŒçš„ä½œç”¨ï¼Œå¯ä»¥åœ¨ï¼š<a href="https://jingwei.link/2018/12/15/ssh-config-multi-app-manager.html" target="_blank" rel="noopener">SSHçš„configé…ç½®ä¹‹å¤šè´¦å·ç®€å•ç®¡ç†</a>ï¼Œå­¦ä¹ ä¸€å“ˆï¼</p><p>æœ€åï¼Œæ ¹æ®æˆ‘çš„éœ€æ±‚ï¼Œåˆ›å»º&amp;ç¼–è¾‘äº†ä¸€ä¸ªconfigæ–‡ä»¶ï¼Œä¸åŒç½‘ç«™å¯¹åº”äº†ä¸åŒçš„keyï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Github</span><br><span class="line">Host opensource   </span><br><span class="line">  Hostname ssh.github.com  </span><br><span class="line">  PreferredAuthentications publickey  </span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line">  User xxxxx@xx.com </span><br><span class="line">  </span><br><span class="line"># Bitbucket</span><br><span class="line">Host private</span><br><span class="line">  HostName bitbucket.org</span><br><span class="line">  Preferredauthentications publickey</span><br><span class="line">  IdentityFile ~/.ssh/id_ed25519_bb</span><br><span class="line">  User git</span><br><span class="line"></span><br><span class="line"># Private GitLab instance</span><br><span class="line">Host work</span><br><span class="line">  HostName 192.160.2.xxx</span><br><span class="line">  port 1888</span><br><span class="line">  Preferredauthentications publickey</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_work</span><br><span class="line">  User git</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™ï¼šBad-owner-or-permissions-on-xxx-ssh-config"><a href="#æŠ¥é”™ï¼šBad-owner-or-permissions-on-xxx-ssh-config" class="headerlink" title="æŠ¥é”™ï¼šBad owner or permissions on ~/xxx/.ssh/config"></a>æŠ¥é”™ï¼šBad owner or permissions on ~/xxx/.ssh/config</h3><p>é…ç½®å®Œconfigæ–‡ä»¶ï¼Œå†æ¬¡é€šè¿‡ssh -Tæµ‹è¯•è¿æ¥ï¼Œå´åˆæŠ¥é”™ï¼Œè¿™æ¬¡æ˜¯é…ç½®æ–‡ä»¶çš„æƒé™ä¸å¤Ÿï¼Œæˆ‘ä»¬ç»™ä»–æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 600 ~/xxx/.ssh/config</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿æ¥å°±æˆåŠŸäº†ï¼Œä¼šæç¤ºä½ successfully autheticatedæˆ–è€…Hi ,welcome to XXXã€‚</p><p>é€šè¿‡sshè¿™ä¸ªé€šè¡Œè¯ï¼Œæ‚¨å¯ä»¥ç”¨sourcetreeä»»æ„ç©è€ä¸å†éœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼Œä¹Ÿä¸å†éœ€è¦è¾“å…¥å¯†é’¥çš„å®‰å…¨ç äº†ï¼ğŸ˜„</p><hr><h2 id="é‡å¯äº†Macï¼Œsourcetreeæ“ä½œåˆæŠ¥æƒé™é”™è¯¯"><a href="#é‡å¯äº†Macï¼Œsourcetreeæ“ä½œåˆæŠ¥æƒé™é”™è¯¯" class="headerlink" title="é‡å¯äº†Macï¼Œsourcetreeæ“ä½œåˆæŠ¥æƒé™é”™è¯¯"></a>é‡å¯äº†Macï¼Œsourcetreeæ“ä½œåˆæŠ¥æƒé™é”™è¯¯</h2><p>soucetreeä¸ºå•¥ä¼šæŠ¥é”™å‘¢ï¼Œå› ä¸ºä»–æ“ä½œå‘½ä»¤æ˜¯ä¸ä¼šå¸®ä½ è¾“å…¥å¯†ç çš„ï¼Œä¹Ÿå°±æ˜¯rsaå¯†é’¥çš„å®‰å…¨ç ï¼</p><p>å½“ç”¨ä½ ç”¨terminalæ“ä½œgitä½ å°±ä¼šå‘ç°ï¼Œåˆéœ€è¦è¾“å…¥rsaçš„passphaseäº†ã€‚</p><p>åœ¨é‡å¯ä¹‹åï¼Œssh-agentä¼°è®¡ï¼ˆå¯èƒ½ï¼Ÿï¼‰ä¹Ÿæ˜¯é‡å¯äº†ï¼Œäºæ˜¯å¯†é’¥ä¸¢å¤±äº†ã€‚</p><p>æ„å‘³ç€æ¯æ¬¡é‡å¯Macä½ å°±è¦å»æ‰§è¡Œssh-add -Kï¼</p><p>æˆ‘ä»¬æŠŠè¿™å‡ ä¸ªå‘½ä»¤è‡ªåŠ¨åŒ–å§ï¼Œåœ¨æ¯æ¬¡å¯åŠ¨æ—¶æ‰§è¡Œshellï¼Œæ­¥éª¤ï¼š</p><ol><li>æ‰¾åˆ°è‡ªåŠ¨æ“ä½œ.appï¼Œåˆ›å»ºä¸€ä¸ªAutomator åº”ç”¨ç¨‹åº</li></ol><p><img src="https://s2.ax1x.com/2019/12/15/QWBxMj.png" alt="1"></p><ol start="2"><li>é€‰æ‹©â€œè¿è¡Œshellè„šæœ¬â€ï¼Œè¾“å…¥å‘½ä»¤ï¼Œç‚¹å‡»é¡¶éƒ¨æœªå‘½åä¿å­˜</li></ol><p><img src="https://s2.ax1x.com/2019/12/15/QWBjzQ.png" alt="2"></p><ol start="3"><li><p>ç³»ç»Ÿåå¥½è®¾ç½®-&gt;ç”¨æˆ·ä¸ç¾¤ç»„-&gt;ç™»å½•é¡¹ï¼Œé€‰æ‹©æˆ‘ä»¬ä¿å­˜çš„appæ–‡ä»¶ï¼Œå®ç°å¼€æœºè‡ªå¯åŠ¨</p><p><img src="https://s2.ax1x.com/2019/12/15/QWBXRg.png" alt="3"></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> ssh </tag>
            
            <tag> Sourcetree </tag>
            
            <tag> Automator </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSæ£€æµ‹ä¼ä¸šåŒ…(.ipa)æ‰ç­¾è„šæœ¬</title>
      <link href="/iOS%E6%A3%80%E6%B5%8B%E4%BC%81%E4%B8%9A%E5%8C%85(.ipa)%E6%8E%89%E7%AD%BE%E8%84%9A%E6%9C%AC.html"/>
      <url>/iOS%E6%A3%80%E6%B5%8B%E4%BC%81%E4%B8%9A%E5%8C%85(.ipa)%E6%8E%89%E7%AD%BE%E8%84%9A%E6%9C%AC.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>â€œå®¢æˆ·è£…ä¸ä¸Šappå•¦ï¼â€<br>â€œå®¢æˆ·æ‰“å¼€appé—ªé€€å•¦ï¼â€<br>â€œiosæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æ‰ç­¾å•¦ï¼â€</p></blockquote><a id="more"></a><div class="note info"><p>é‡åˆ°ä¼ä¸šè¯ä¹¦è¢«Revokeçš„æƒ…å†µï¼Œä¼šå¯¼è‡´å·²è£…å¥½å¹¶ä¸”æ‰‹åŠ¨ä¿¡ä»»çš„ä¼ä¸šåŒ…appæ‰“å¼€é—ªé€€ï¼Œæˆ–æ–°ç”¨æˆ·è£…ä¸Šappå›¾æ ‡æ˜¯ç°è‰²çš„ã€‚</p></div><p>å¤ªçƒ¦äº†ï¼Œæ¯æ¬¡æ£€æŸ¥è¦é‡æ–°ä¸‹è½½å®‰è£…ä¸€æ¬¡ç¡®è®¤ï¼Œæµªè´¹æ—¶é—´ï¼Œæµé‡ï¼Œåˆæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œä¸èƒ½æ¯æ¬¡éƒ½è¦å› ä¸ºè¿™ç§é—®é¢˜æµªè´¹å®è´µçš„æ—¶é—´ï¼Œè€Œä¸”æ˜¯å¦æ‰ç­¾æˆ‘ä»¬ä½œä¸ºå¼€å‘è¦ç”¨äº‹å®&amp;æ•°æ®è¯´è¯ï¼</p><ul><li>æˆ‘ä»¬å¯ä»¥ç”¨Appleè‡ªå¸¦çš„codesignå‘½ä»¤å¯¹appæ–‡ä»¶å†…çš„ç­¾åå¯¼å‡º</li><li>å†é€šè¿‡OpenSSLå‘½ä»¤å»æ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸ</li></ul><p>å¦‚æœæ£€æŸ¥ä¸åˆ°æœ‰æ•ˆæœŸæˆ–è€…æ˜¾ç¤ºäº†â€Revokedâ€ï¼Œè‡ªç„¶è¡¨ç¤ºç­¾åä¸å¯ç”¨ï¼Œä¹Ÿæ„å‘³ç€è¯ä¹¦æŒ‚äº†ã€‚<br>å‚è€ƒäº†å‡ ç¯‡æ–‡ï¼ˆæ‰¾ä¸åˆ°äº†ï¼‰ï¼Œå¹¶å¼„äº†ä¸€ä¸ªè„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> USAGE: ./checkSign.sh &#123;ipaæ–‡ä»¶åï¼šxxx.ipa&#125;</span><br><span class="line"><span class="meta">#</span> çœ‹åˆ°âš ï¸è¯æ˜è¯¥ipaè¯ä¹¦ç­¾åæœ‰é—®é¢˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤æ–‡ä»¶</span><br><span class="line">echo "ğŸ—‘ åˆ é™¤codesign,pem,plist,å’Œâ€œPayloadâ€æ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶"</span><br><span class="line">if [ -d "Payload" ] ; then</span><br><span class="line">rm -rf Payload</span><br><span class="line">fi</span><br><span class="line">rm -f codesign0</span><br><span class="line">rm -f codesign1</span><br><span class="line">rm -f codesign2</span><br><span class="line">rm -f *.pem</span><br><span class="line">rm -f *.plist</span><br><span class="line">rm -f iTunesArtwork</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å‚æ•°æ£€æŸ¥</span><br><span class="line">canshu=$1</span><br><span class="line">ipaFile=$&#123;canshu##*/&#125;</span><br><span class="line"><span class="meta">#</span> æˆªå–&amp;æ‹¼æ¥.app</span><br><span class="line">appFile=$&#123;ipaFile%.*&#125;".app"</span><br><span class="line">islegal=$(echo $1 | grep ".ipa$")</span><br><span class="line">echo "ğŸ‘€ è¯·æ£€æŸ¥å‚æ•°"</span><br><span class="line">echo "ipa: $ipaFile"</span><br><span class="line">echo "app: $appFile"</span><br><span class="line">if [ -n "$islegal" ]; then</span><br><span class="line">if [ ! -f "$ipaFile" ]; then</span><br><span class="line">echo "âŒ â€œ$1â€æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç»“æŸè¿›ç¨‹"</span><br><span class="line">exit 0</span><br><span class="line">fi</span><br><span class="line">else</span><br><span class="line">echo "âŒ å‚æ•°æ ¼å¼å¿…é¡»æ˜¯æ–‡ä»¶å…¨å:xxx.ipaï¼Œç»“æŸè¿›ç¨‹"</span><br><span class="line">exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è§£å‹</span><br><span class="line">unzip -q $ipaFile</span><br><span class="line"><span class="meta">#</span> å¯¼å‡ºç­¾å</span><br><span class="line">codesign -dvv --extract-certificates Payload/*.app</span><br><span class="line">if [ ! -f "codesign0" ] || [ ! -f "codesign1" ] || [ ! -f "codesign2" ]; then</span><br><span class="line">echo "âš ï¸ å¯¼å‡ºcodesignå®Œæ•´3ä¸ªæ–‡ä»¶å¤±è´¥ï¼Œè¯¥ipaæ–‡ä»¶è¯ä¹¦è¿‡æœŸæˆ–è€…è¢«æŸå"</span><br><span class="line"><span class="meta">#</span>TODO: å¯åœ¨è¿™é‡Œåšæ›¿æ¢ipaæ“ä½œ</span><br><span class="line">else</span><br><span class="line">openssl x509 c-inform DER -in codesign0 -out codesign0.pem</span><br><span class="line">openssl x509 -inform DER -in codesign1 -out codesign1.pem</span><br><span class="line">openssl x509 -inform DER -in codesign2 -out codesign2.pem</span><br><span class="line">cat codesign1.pem codesign2.pem &gt; cachain.pem</span><br><span class="line">openssl x509 -inform DER -in codesign0 -noout -nameopt -oneline -subject -serial -dates</span><br><span class="line">if openssl ocsp -issuer cachain.pem -cert codesign0.pem -url `openssl x509 -in codesign0.pem -noout -ocsp_uri` -CAfile cachain.pem -header 'host' 'ocsp.apple.com' | grep revoked ; then</span><br><span class="line">    echo "âš ï¸ è¯ä¹¦è¢«Revokeï¼Œè¯·æ›¿æ¢"</span><br><span class="line">    #TODO: å¯åœ¨è¿™é‡Œåšæ›¿æ¢ipaæ“ä½œ</span><br><span class="line">else</span><br><span class="line">    echo "ğŸ’¯æ‰§è¡Œå®Œæ¯•ï¼Œè¯¥ipaåŒ…è¯ä¹¦å¯ç”¨"</span><br><span class="line">fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬å¯ä»¥ä¸¢ç»™è¿ç»´ï¼Œè®©ä»–åšå®šæ—¶æ£€æŸ¥ï¼Œä»–è¿˜å¯ä»¥åšæ‰ç­¾æŠ¥è­¦å’Œåˆ‡æ¢ç­‰..<br>ä»¥åæ‰ç­¾é—®é¢˜é—®è¿ç»´ï¼Œä¸è¦å†æ¥é—®æˆ‘å•¦ï½ï¼ˆåˆ«æ‰“æ‰°æˆ‘æ‘¸é±¼ï¼‰</p>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> ä¼ä¸šç­¾å </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº”ç”¨å†…æ£€æµ‹ç½‘ç»œè¿æ¥æ˜¯å¦å¼€å¯ä»£ç†(VPN)</title>
      <link href="/iOS%E5%BA%94%E7%94%A8%E5%86%85%E6%A3%80%E6%B5%8B%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E4%BB%A3%E7%90%86-VPN.html"/>
      <url>/iOS%E5%BA%94%E7%94%A8%E5%86%85%E6%A3%80%E6%B5%8B%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E4%BB%A3%E7%90%86-VPN.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>æˆ‘ä»¬éœ€è¦æ£€æµ‹ç”¨æˆ·çš„ç½‘ç»œIPåœ°å€æ˜¯å¦å¼€å¯äº†ä»£ç†ï¼ˆVPNï¼‰ï¼Œé˜²æ­¢ä¸€äº›ç”¨æˆ·é€šè¿‡å…³é—­GPSï¼Œè®©æˆ‘ä»¬çš„IPå®šä½é”™è¯¯ï¼Œéæ³•è·å–æˆ‘ä»¬é™åˆ¶äº†åœ°åŸŸçš„ä¼˜æƒ ï¼Œæˆ–è€…æ˜¯ä¼ é€’è™šå‡ç½‘ç»œä¿¡æ¯ã€‚</p></blockquote><a id="more"></a><div class="note primary">            <p>å¯ä»¥é€šè¿‡åˆ¤æ–­â€œ<strong>tap</strong> <strong>tun</strong> <strong>ipsec</strong> <strong>ppp</strong>â€ è¿™äº›å­—æ®µæ˜¯å¦åœ¨â€œ<strong>CFNetworkCopySystemProxySettings</strong>â€é‡Œï¼Œæ¥åˆ¤æ–­<strong>vpn</strong>æ˜¯å¦å¼€å¯ã€‚</p>          </div><p>å®Œæ•´æ–¹æ³•åœ¨æ­¤ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)isVPNOn</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">BOOL</span> flag = <span class="literal">NO</span>;</span><br><span class="line">   <span class="built_in">NSString</span> *version = [<span class="built_in">UIDevice</span> currentDevice].systemVersion;</span><br><span class="line">   <span class="comment">// need two ways to judge this.</span></span><br><span class="line">   <span class="keyword">if</span> (version.doubleValue &gt;= <span class="number">9.0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="built_in">NSDictionary</span> *dict = <span class="built_in">CFBridgingRelease</span>(<span class="built_in">CFNetworkCopySystemProxySettings</span>());</span><br><span class="line">       <span class="built_in">NSArray</span> *keys = [dict[<span class="string">@"__SCOPED__"</span>] allKeys];</span><br><span class="line">       <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> keys) &#123;</span><br><span class="line">           <span class="keyword">if</span> ([key rangeOfString:<span class="string">@"tap"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">               [key rangeOfString:<span class="string">@"tun"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">               [key rangeOfString:<span class="string">@"ipsec"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">               [key rangeOfString:<span class="string">@"ppp"</span>].location != <span class="built_in">NSNotFound</span>)&#123;</span><br><span class="line">               flag = <span class="literal">YES</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">struct</span> ifaddrs *interfaces = <span class="literal">NULL</span>;</span><br><span class="line">       <span class="keyword">struct</span> ifaddrs *temp_addr = <span class="literal">NULL</span>;</span><br><span class="line">       <span class="keyword">int</span> success = <span class="number">0</span>;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// retrieve the current interfaces - returns 0 on success</span></span><br><span class="line">       success = getifaddrs(&amp;interfaces);</span><br><span class="line">       <span class="keyword">if</span> (success == <span class="number">0</span>)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="comment">// Loop through linked list of interfaces</span></span><br><span class="line">           temp_addr = interfaces;</span><br><span class="line">           <span class="keyword">while</span> (temp_addr != <span class="literal">NULL</span>)</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="built_in">NSString</span> *string = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%s"</span> , temp_addr-&gt;ifa_name];</span><br><span class="line">               <span class="keyword">if</span> ([string rangeOfString:<span class="string">@"tap"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">                   [string rangeOfString:<span class="string">@"tun"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">                   [string rangeOfString:<span class="string">@"ipsec"</span>].location != <span class="built_in">NSNotFound</span> ||</span><br><span class="line">                   [string rangeOfString:<span class="string">@"ppp"</span>].location != <span class="built_in">NSNotFound</span>)</span><br><span class="line">               &#123;</span><br><span class="line">                   flag = <span class="literal">YES</span>;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               temp_addr = temp_addr-&gt;ifa_next;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// Free memory</span></span><br><span class="line">       freeifaddrs(interfaces);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯åˆ¤æ–­ç³»ç»Ÿçš„vpnçŠ¶æ€ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯è°ƒèµ·vpnExtensionæˆ–ç€è¯´NEVPNManagerçš„æ—¶å€™çš„vpnçŠ¶æ€å¯ä»¥é€šè¿‡å®ä¾‹åŒ–NEVPNManagerï¼Œç„¶åé€šè¿‡manager.connection.statusæ¥è·å–å½“å‰çš„vpnçŠ¶æ€ã€‚</p><p>è¯¥æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å¦‚æœç”¨æˆ·æ˜¯è¿æ¥äº†å·²ç»å¼€å¯ä»£ç†çš„<strong>Wi-Fi</strong>ç½‘ç»œï¼Œé‚£æˆ‘ä»¬å°±æ— æ³•æ£€æµ‹åˆ°å•¦ï¼å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•æ¬¢è¿ç•™è¨€å‘ŠçŸ¥ï½</p>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> å¼€å‘ä¹‹æœ¯ </tag>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOS WKWebViewå®ç°Postè¯·æ±‚</title>
      <link href="/iOS-WKWebView%E5%AE%9E%E7%8E%B0Post%E8%AF%B7%E6%B1%82.html"/>
      <url>/iOS-WKWebView%E5%AE%9E%E7%8E%B0Post%E8%AF%B7%E6%B1%82.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>ï¼ˆæ•²é”£æ‰“é¼“ï¼‰ZFæ¸ é“çš„æœ‹å‹åˆæ¥æäº‹æƒ…äº†ï¼</p></blockquote><a id="more"></a><p>ï¼ˆå¬å¥½äº†å¬å¥½äº†ï¼‰ç°åœ¨çš„éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼</p><blockquote><p>é€šè¿‡æˆ‘ä»¬å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªAè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªURLä»¥åŠæ‰€æœ‰éœ€è¦çš„å‚æ•°ï¼Œæˆ‘ä»¬å†é€šè¿‡WebViewå‘èµ·Postè¯·æ±‚çš„æ–¹å¼ï¼ˆå…¶ä¸­æœ‰é‡å®šå‘è·³è½¬ï¼‰æ‹¿åˆ°æœ€åçš„HTMLä¿¡æ¯ã€‚</p></blockquote><p>å› ä¸ºUIWebViewæœ‰å†…å­˜æ³„æ¼å’Œä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œæœ¬ç€å–œæ–°åŒæ—§çš„æœ¬æ€§ï¼Œé¡¹ç›®ä¸­çš„WebViewå·²ç»å…¨é¢è½¬äº†WKWebViewã€‚</p><h1 id="WKWebView-fail-to-load-post-request"><a href="#WKWebView-fail-to-load-post-request" class="headerlink" title="WKWebView fail to load post request"></a>WKWebView fail to load post request</h1><p>ç¬¬ä¸€æ¬¡å°è¯•ï¼Œè‡ªå®šä¹‰äº†SURLRequestï¼Œå°†æ–¹æ³•æ”¹ä¸ºpostï¼Œå°†å‚æ•°è½¬ç ï¼Œç”šè‡³è¿˜è‡ªå®šä¹‰äº†content-typeï¼Œç„¶é¹…è¯·æ±‚å´å¤±è´¥ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableURLRequest</span> * requestShare = [[<span class="built_in">NSMutableURLRequest</span> alloc]initWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.urlStr]] </span><br><span class="line">[request setHTTPMethod:<span class="string">@"POST"</span>];</span><br><span class="line">[requset setValue:<span class="string">@"application/x-www-form-urlencoded"</span> forHTTPHeaderField:<span class="string">@"Content-Type"</span>];</span><br><span class="line">[request setHTTPBody:[<span class="string">@"id=12&amp;name=Jhon&amp;token=skjasjlfjalsl"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>]]; <span class="comment">//ç¤ºä¾‹</span></span><br><span class="line">[<span class="keyword">self</span>.wkwebview loadRequest:request];</span><br></pre></td></tr></table></figure><p>åæ¥è°·æ­Œäº†..å‘ç°ç”±äº WKWebView åœ¨ç‹¬ç«‹è¿›ç¨‹é‡Œæ‰§è¡Œç½‘ç»œè¯·æ±‚ã€‚ä¸€æ—¦æ³¨å†Œ http(s) scheme åï¼Œç½‘ç»œè¯·æ±‚å°†ä» Network Process å‘é€åˆ° App Processï¼Œè¿™æ · NSURLProtocol æ‰èƒ½æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚åœ¨ webkit2 çš„è®¾è®¡é‡Œä½¿ç”¨ MessageQueue è¿›è¡Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ŒNetwork Process ä¼šå°†è¯·æ±‚ encode æˆä¸€ä¸ª Message,ç„¶åé€šè¿‡ IPC å‘é€ç»™ App Processã€‚å‡ºäºæ€§èƒ½çš„åŸå› ï¼Œencode çš„æ—¶å€™ HTTPBody å’Œ HTTPBodyStream è¿™ä¸¤ä¸ªå­—æ®µè¢«ä¸¢å¼ƒæ‰äº†ï¼<br><a href="https://github.com/WebKit/webkit/blob/fe39539b83d28751e86077b173abd5b7872ce3f9/Source/WebKit2/Shared/mac/WebCoreArgumentCodersMac.mm#L61-L88" target="_blank" rel="noopener">å®˜æ–¹æºç </a></p><p>è‹¹æœå·¥ç¨‹å¸ˆå¯¹æ­¤ä¹Ÿä½œå‡ºäº†<a href="https://forums.developer.apple.com/thread/18952" target="_blank" rel="noopener">å›å¤</a>ï¼Œå›å¤æ–‡ç« ä¸­ï¼Œè‹¹æœå·¥ç¨‹å¸ˆè¿˜éå¸¸çƒ­å¿ƒçš„å‘Šè¯‰å¼€å‘è€…ï¼Œå“ˆå“ˆä½ çš„UIWebViewèƒ½å¤Ÿå‘é€Postè¯·æ±‚ä¹Ÿåªæ˜¯ä¸€ä¸ªæ„å¤–ï¼Œæˆ‘ä»¬æ ¹æœ¬å°±æ²¡æƒ³è®©ä½ ä»¬è¿™æ ·ç©ï¼WebViewåªèƒ½é€šè¿‡GETè¯·æ±‚å»ºç«‹ï¼Œè¦ä¸ä½ ä»¬å°è¯•ç”¨JavaScriptå‘postè¯·æ±‚è€è€å‘—ã€‚</p><h1 id="JSå¤§æ³•å¥½"><a href="#JSå¤§æ³•å¥½" class="headerlink" title="JSå¤§æ³•å¥½"></a>JSå¤§æ³•å¥½</h1><p>OCçš„ä¸è¶³å°±è®©JSæ¥è¡¥è¶³å§ï¼ˆæ€ªæŠ¼éŸµçš„ï¼Ÿï¼‰</p><div class="note info">            <p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨JSæ¥åŠ¨æ€çš„ç”ŸæˆHTMLé‡Œçš„formæ ‡ç­¾ï¼Œç„¶åç”¨formè¡¨å•æ¥å®ç°POSTè¯·æ±‚ã€‚<br>è€Œä¸”WKWebViewå³ä½¿ä¸åŠ è½½ä»»ä½•htmlå’Œrequestï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œjsæ–¹æ³•ï¼ˆåŠç‚¸å¤©äº†ï¼‰ã€‚</p>          </div><ol><li><strong>æˆ‘ä»¬å°†JSä»£ç å®šä¹‰æˆä¸€ä¸ªå³æ’å³ç”¨çš„å®æ–¹æ³•ã€‚</strong></li></ol><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define POST_JS @<span class="meta-string">"function my_post(path, params) &#123;\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">var method = \"</span>POST\<span class="meta-string">";\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">var form = document.createElement(\"</span>form\<span class="meta-string">");\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">form.setAttribute(\"</span>method\<span class="meta-string">", method);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">form.setAttribute(\"</span>action\<span class="meta-string">", path);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">for(var key in params)&#123;\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">    if (params.hasOwnProperty(key)) &#123;\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">        var hiddenFild = document.createElement(\"</span>input\<span class="meta-string">");\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">        hiddenFild.setAttribute(\"</span>type\<span class="meta-string">", \"</span>hidden\<span class="meta-string">");\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">        hiddenFild.setAttribute(\"</span>name\<span class="meta-string">", key);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">        hiddenFild.setAttribute(\"</span>value\<span class="meta-string">", params[key]);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">    &#125;\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">    form.appendChild(hiddenFild);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&#125;\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">document.body.appendChild(form);\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">form.submit();\</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&#125;"</span></span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>å‘é€è¯·æ±‚ï¼</strong></li></ol><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// url - è¯·æ±‚å‘é€çš„åœ°å€</span></span><br><span class="line"><span class="comment">// paramStr - è¦ä¼ é€’çš„å‚æ•°,æ ¼å¼éœ€è¦è½¬æˆåˆæ³•çš„jsonå­—ç¬¦ä¸²,å¦‚ï¼š@"&#123;\"token\":\"cac6af340960485aa334416c8a34ddbf\"&#125;";</span></span><br><span class="line"><span class="comment">// js - éœ€è¦wkwebViewæ‰§è¡Œçš„JSä»£ç ï¼Œpostä¸€ä»½formè¡¨å•</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> * js = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@my_post(\"%@\", %@)"</span>,POST_JS,url,dataStr];</span><br><span class="line">[<span class="keyword">self</span>.wkwebview evaluateJavaScript:js completionHandler:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure><p>å—¯å—¯ï¼Œè¿™æ ·å°±å¤ªçˆ½äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> WKWebView </tag>
            
            <tag> å¼€å‘ä¹‹æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Objective-Cä¸­åŸºç¡€é”åŠå…¶æ€§èƒ½æ¢ç©¶</title>
      <link href="/Objective-C%E4%B8%AD%E5%9F%BA%E7%A1%80%E9%94%81%E5%8F%8A%E5%85%B6%E6%80%A7%E8%83%BD%E6%8E%A2%E7%A9%B6.html"/>
      <url>/Objective-C%E4%B8%AD%E5%9F%BA%E7%A1%80%E9%94%81%E5%8F%8A%E5%85%B6%E6%80%A7%E8%83%BD%E6%8E%A2%E7%A9%B6.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>æ‡‚ç‚¹é”ï¼Œæ‰èƒ½å†™å¥½å¤šçº¿ç¨‹ã€‚</p></blockquote><a id="more"></a><h2 id="çº¿ç¨‹é”"><a href="#çº¿ç¨‹é”" class="headerlink" title="çº¿ç¨‹é”"></a>çº¿ç¨‹é”</h2><p>æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹ä¸­å¤§å±•æ‹³è„šçš„æ—¶å€™ï¼Œæ€»å¯èƒ½ä¼šé‡åˆ°èµ„æºäº‰å¤ºï¼Œå¯¼è‡´æ•°æ®æ··ä¹±ï¼Œçº¿ç¨‹é”è¿™ä¸ªæ—¶å€™å¯ä»¥ä¸ºæˆ‘ä»¬çš„æ•°æ®èµ„æºä¿é©¾æŠ¤èˆªï¼Œåœ¨OCä¸­åŸºç¡€çš„é”æœ‰@synchronizedï¼ŒNSLockï¼Œpthreadï¼ŒOSSpinLockã€‚</p><p>æˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªç±»ï¼Œå‡è®¾å½“å‰å®ƒæ˜¯æˆ‘ä»¬çš„ä¸€ä¸ªå…±äº«èµ„æºï¼Œä¸”func1ä¸func2æ˜¯ä¸¤ä¸ªäº’æ–¥çš„æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TokenObj</span></span></span><br><span class="line">- (<span class="keyword">void</span>)func1&#123;</span><br><span class="line"><span class="comment">//è¯»å†™æ“ä½œ1</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)func2&#123;</span><br><span class="line"><span class="comment">//è¯»å†™æ“ä½œ2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ä»¥ä¸Šå››ç§é”å®ç°åœ¨ä¸åŒçº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™é”ä½èµ„æºã€‚</p><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TokenObj *obj = [[TokenObj alloc] init];</span><br><span class="line"><span class="comment">//çº¿ç¨‹1</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="keyword">@synchronized</span>(obj)&#123;</span><br><span class="line">        [obj func1];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//çº¿ç¨‹2</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    sleep(<span class="number">1</span>);<span class="comment">//ä»¥ä¿è¯è®©çº¿ç¨‹2çš„ä»£ç åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">@synchronized</span>(obj)&#123;</span><br><span class="line">        [obj func2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>@synchronizedæŒ‡ä»¤ä¸­çš„tokenä¸ºè¯¥é”çš„å”¯ä¸€æ ‡è¯†å¯¹è±¡ï¼Œè¯¥æŒ‡ä»¤åªå¯¹ç›¸åŒæ ‡è¯†ä¸­çš„å¯¹è±¡è¿›è¡ŒåŠ é”ã€‚<br>ç”¨@synchronizedå®ç°é”çš„ä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°åˆ›å»ºé”å¯¹è±¡ï¼Œä¾¿å¯ä»¥å®ç°é”çš„æœºåˆ¶ï¼Œä½†æ˜¯å®ƒä¼šéšå¼åœ°æ·»åŠ ä¸€ä¸ªå¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼ˆè¯¥å†å¤„ç†ä¾‹ç¨‹ä¼šåœ¨å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”ï¼‰æ¥ä¿æŠ¤ä»£ç ã€‚å› æ­¤è¯¥æŒ‡ä»¤ä¼šå› ä¸ºè¯¥ä¾‹ç¨‹å¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ï¼Œä¸‹é¢æˆ‘ä»¬å¯¹æ¯”æ€§èƒ½çš„æ—¶å€™å°±èƒ½çœ‹åˆ°ã€‚</p><h4 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TokenObj *obj = [[TokenObj alloc] init];</span><br><span class="line"><span class="built_in">NSLock</span> *lock = [[<span class="built_in">NSLock</span> alloc] init];</span><br><span class="line"><span class="comment">//çº¿ç¨‹1</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    [lock lock];</span><br><span class="line">    [obj func1];</span><br><span class="line">    [lock unlock];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//çº¿ç¨‹2</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    [lock lock];</span><br><span class="line">    [obj func2];</span><br><span class="line">    [lock unlock];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>NSLockæ˜¯Cocoaæä¾›ç»™æˆ‘ä»¬æœ€åŸºæœ¬çš„é”å¯¹è±¡ï¼Œé™¤lockå’Œunlockæ–¹æ³•å¤–ï¼ŒNSLockè¿˜æä¾›äº†tryLockå’ŒlockBeforeDate:ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰ä¸€ä¸ªæ–¹æ³•ä¼šå°è¯•åŠ é”ï¼Œå¦‚æœé”ä¸å¯ç”¨(å·²ç»è¢«é”ä½)ï¼Œåˆšå¹¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¹¶è¿”å›NOã€‚lockBeforeDate:æ–¹æ³•ä¼šåœ¨æ‰€æŒ‡å®šDateä¹‹å‰å°è¯•åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰éƒ½ä¸èƒ½åŠ é”ï¼Œåˆ™è¿”å›NOã€‚</p><h4 id="pthread"><a href="#pthread" class="headerlink" title="pthread"></a>pthread</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TokenObj *obj = [[TokenObj alloc] init];</span><br><span class="line">__block pthread_mutex_t mutex;</span><br><span class="line">pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    [obj func1];</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    [obj func2];</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>pthread_mutex_tæ˜¯Cè¯­è¨€æ¨¡å—ï¼Œåœ¨ä½¿ç”¨æ—¶è¦å¼•ç”¨â€pthread.hâ€ã€‚</p><h4 id="dispatch-semaphore-å®ç°é”"><a href="#dispatch-semaphore-å®ç°é”" class="headerlink" title="dispatch_semaphore å®ç°é”"></a>dispatch_semaphore å®ç°é”</h4><p>ä»¥ä¸Šä»£ç æ„å»ºå¤šçº¿ç¨‹æˆ‘ä»¬å°±å·²ç»ç”¨åˆ°äº†GCDçš„dispatch_asyncæ–¹æ³•ï¼Œå…¶å®åœ¨GCDä¸­ä¹Ÿå·²ç»æä¾›äº†ä¸€ç§ä¿¡å·æœºåˆ¶ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¥æ„å»ºä¸€æŠŠâ€é”â€(ä»æœ¬è´¨æ„ä¹‰ä¸Šè®²ï¼Œä¿¡å·é‡ä¸é”æ˜¯æœ‰åŒºåˆ«ï¼Œå…·ä½“å·®å¼‚å‚åŠ ä¿¡å·é‡ä¸äº’æ–¥é”ä¹‹é—´çš„åŒºåˆ«)</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TokenObj *obj = [TokenObj alloc] init];</span><br><span class="line">dispatch_semaphore semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//çº¿ç¨‹1</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    [obj func1];</span><br><span class="line">    dispatch_semaphore_signal(semaphore);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//çº¿ç¨‹2</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">    [obj func2];</span><br><span class="line">    dispatch_semaphore_signal(semaphore);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å»äº†è§£ä¸€ä¸‹dispatch_semaphoreã€‚</p><h4 id="OSSpinLock-deprecated"><a href="#OSSpinLock-deprecated" class="headerlink" title="OSSpinLock (deprecated)"></a>OSSpinLock (deprecated)</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TokenObj *obj = [[TokenObj alloc] init];</span><br><span class="line">OSSpinLock spinlock = OS_SPINLOCK_INIT;</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    OSSpinLockLock(&amp;spinlock);</span><br><span class="line">    [obj func1];</span><br><span class="line">    OSSpinLockUnlock(&amp;spinlock);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">    OSSpinLockLock(&amp;spinlock);</span><br><span class="line">    [obj func2];</span><br><span class="line">    OSSpinLockUnlock(&amp;spinlock);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>OSSpinLockå› ä¸ºå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œåœ¨iOS10.0ä»¥åå°±è¢«å¼ƒç”¨äº†ï¼Œå¯ä»¥ä½¿ç”¨os_unfair_lock_lockæ›¿ä»£ï¼ˆé™¤äº† OSSpinLock å¤–ï¼Œdispatch_semaphore å’Œ pthread_mutex æ€§èƒ½æ˜¯æœ€é«˜çš„ï¼‰ã€‚å…·ä½“å‚è€ƒï¼š<a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/" target="_blank" rel="noopener">ä¸å†å®‰å…¨çš„ OSSpinLock</a>ã€‚</p><h2 id="æ€§èƒ½æ¢ç©¶"><a href="#æ€§èƒ½æ¢ç©¶" class="headerlink" title="æ€§èƒ½æ¢ç©¶"></a>æ€§èƒ½æ¢ç©¶</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;libkern/OSAtomic.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define ITERATIONS (1024*1024*32)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> disp=<span class="number">0</span>, land=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">double</span> then, now;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i, count;</span><br><span class="line">pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line">OSSpinLock spinlock = OS_SPINLOCK_INIT;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [<span class="built_in">NSAutoreleasePool</span> new];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLock</span> *lock = [<span class="built_in">NSLock</span> new];</span><br><span class="line">then = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ITERATIONS;++i)</span><br><span class="line">&#123;</span><br><span class="line">[lock lock];</span><br><span class="line">[lock unlock];</span><br><span class="line">&#125;</span><br><span class="line">now = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">printf(<span class="string">"NSLock: %f sec\n"</span>, now-then);    </span><br><span class="line"></span><br><span class="line">then = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">IMP lockLock = [lock methodForSelector:<span class="keyword">@selector</span>(lock)];</span><br><span class="line">IMP unlockLock = [lock methodForSelector:<span class="keyword">@selector</span>(unlock)];</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ITERATIONS;++i)</span><br><span class="line">&#123;</span><br><span class="line">lockLock(lock,<span class="keyword">@selector</span>(lock));</span><br><span class="line">unlockLock(lock,<span class="keyword">@selector</span>(unlock));</span><br><span class="line">&#125;</span><br><span class="line">now = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">printf(<span class="string">"NSLock+IMP Cache: %f sec\n"</span>, now-then);    </span><br><span class="line"></span><br><span class="line">then = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ITERATIONS;++i)</span><br><span class="line">&#123;</span><br><span class="line">pthread_mutex_lock(&amp;mutex);</span><br><span class="line">pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">&#125;</span><br><span class="line">now = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">printf(<span class="string">"pthread_mutex: %f sec\n"</span>, now-then);</span><br><span class="line"></span><br><span class="line">then = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ITERATIONS;++i)</span><br><span class="line">&#123;</span><br><span class="line">OSSpinLockLock(&amp;spinlock);</span><br><span class="line">OSSpinLockUnlock(&amp;spinlock);</span><br><span class="line">&#125;</span><br><span class="line">now = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">printf(<span class="string">"OSSpinlock: %f sec\n"</span>, now-then);</span><br><span class="line"></span><br><span class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSObject</span> new];</span><br><span class="line"></span><br><span class="line">then = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ITERATIONS;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">@synchronized</span>(obj)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">now = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line">printf(<span class="string">"@synchronized: %f sec\n"</span>, now-then);</span><br><span class="line"></span><br><span class="line">[pool release];</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ä»¥ä¸Šä»£ç åˆ†åˆ«å¯¹å››ç§åŸºç¡€é”çš„æ€§èƒ½è¿›è¡Œæ¢ç©¶ã€‚ä»£ç ä¸­æˆ‘ä»¬ç®€å•åœ°åŠ é”è§£é”é‡å¤33554432æ¬¡ï¼Œç„¶åè®¡ç®—å‰åæ¶ˆè€—æ—¶é—´ï¼Œæ’é™¤äº†è‡ªåŠ¨é‡Šæ”¾æ± çš„å½±å“ã€‚è¿è¡Œå‡ æ¬¡å¹¶å–å¹³å‡å€¼ç»Ÿè®¡å‡ºä¸‹å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB8lOs.png" alt="æ€§èƒ½æ¯”è¾ƒ"></p><p>@synchronizedå¿…é¡»è®¾ç½®ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå®ƒå®é™…ä¸Šæœ€ç»ˆä¼šåœ¨é‚£é‡Œé‡‡å–ä¸€äº›å†…éƒ¨é”ã€‚ä¸ºäº†è·å¾—å¯é”å®šçš„é”è€Œæ”¯ä»˜å‡ ä¸ªåŠ é”è§£é”çš„è´¹ç”¨ã€‚é™¤äº†å°‘å†™å‡ è¡Œä»£ç ï¼Œå¸¦æ¥çš„é¢å¤–å¼€é”€æ˜¯å…¶å®ƒé”çš„æ¶ˆè€—3å€ä»¥ä¸Šã€‚</p><p>OSSpinLockç”šè‡³æ²¡æœ‰è¿›å…¥å†…æ ¸ - å®ƒåªæ˜¯ä¸æ–­é‡æ–°åŠ è½½é”ï¼Œå¸Œæœ›å®ƒè¢«è§£é”ã€‚å¦‚æœé”ä¿æŒè¶…è¿‡å‡ çº³ç§’ï¼Œè¿™æ˜¯éå¸¸ä½æ•ˆçš„ã€‚ä¸€æ–¹é¢å®ƒèŠ‚çœäº†æ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨å’Œå‡ ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯å› ä¸ºiOSç³»ç»Ÿå…³äºçº¿ç¨‹ä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œç ´åäº†SpinLockçš„æœºåˆ¶ï¼Œå› æ­¤å®ƒä¹Ÿå˜å¾—ä¸å†å®‰å…¨äº†ã€‚</p><p>NSLockæ˜¯pthreadçš„ä¸€ä¸ªæ¼‚äº®çš„åŒ…è£…å™¨ã€‚å› æ­¤ä½¿ç”¨å®ƒè€Œä¸æ˜¯pthreadæ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> çº¿ç¨‹é” </tag>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> åŸºç¡€çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>atomicä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</title>
      <link href="/atomic%E4%B8%80%E5%AE%9A%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97%EF%BC%9F.html"/>
      <url>/atomic%E4%B8%80%E5%AE%9A%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97%EF%BC%9F.html</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center"><p><strong>ä¸æ˜¯</strong></p></blockquote><a id="more"></a><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><p>åœ¨å¤šçº¿ç¨‹åŒæ—¶å·¥ä½œçš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šç»™æ¯æ¡çº¿ç¨‹åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œä½†æ˜¯ä»–ä»¬ä¼šå…¬ç”¨å †é‡Œé¢çš„æ•°æ®ã€‚<br>é€šè¿‡è¿ç”¨çº¿ç¨‹é”å’ŒåŸå­æ€§ç­‰æ–¹æ³•é¿å…å¤šæ¡çº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å—å†…å­˜å˜é‡é€ æˆçš„æ•°æ®é”™è¯¯æˆ–è€…å†²çªã€‚</p><h2 id="atomicä¸€å®šå®‰å…¨ä¹ˆï¼Ÿ"><a href="#atomicä¸€å®šå®‰å…¨ä¹ˆï¼Ÿ" class="headerlink" title="atomicä¸€å®šå®‰å…¨ä¹ˆï¼Ÿ"></a>atomicä¸€å®šå®‰å…¨ä¹ˆï¼Ÿ</h2><p>nonatomicçš„å†…å­˜ç®¡ç†è¯­ä¹‰æ˜¯éåŸå­æ€§çš„ï¼ŒéåŸå­æ€§çš„æ“ä½œæœ¬æ¥å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè€Œatomicçš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä¼šå¢åŠ æ­£ç¡®çš„å‡ ç‡ï¼Œèƒ½å¤Ÿæ›´å¥½çš„é¿å…çº¿ç¨‹çš„é”™è¯¯ï¼Œä½†æ˜¯å®ƒä»ç„¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p><p><em>atomicæ‰€è¯´çš„çº¿ç¨‹å®‰å…¨åªæ˜¯ä¿è¯äº†getterå’Œsetterå­˜å–æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</em></p><p>eg:å½“çº¿ç¨‹Aè¿›è¡Œå†™æ“ä½œï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹çš„è¯»æˆ–è€…å†™æ“ä½œä¼šå› ä¸ºè¯¥æ“ä½œè€Œç­‰å¾…ã€‚å½“Açº¿ç¨‹çš„å†™æ“ä½œç»“æŸåï¼ŒBçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œç„¶åå½“Açº¿ç¨‹éœ€è¦è¯»æ“ä½œæ—¶ï¼Œå´è·å¾—äº†åœ¨Bçº¿ç¨‹ä¸­çš„å€¼ï¼Œè¿™å°±ç ´åäº†çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœæœ‰çº¿ç¨‹Cåœ¨Açº¿ç¨‹è¯»æ“ä½œå‰releaseäº†è¯¥å±æ€§ï¼Œé‚£ä¹ˆè¿˜ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚æ‰€ä»¥ä»…ä»…ä½¿ç”¨atomicå¹¶ä¸ä¼šä½¿å¾—çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬è¿˜è¦ä¸ºçº¿ç¨‹æ·»åŠ lockæ¥ç¡®ä¿çº¿ç¨‹çš„å®‰å…¨ã€‚</p><p>è€Œä¸”ï¼Œatomicæ¯”nonatomicçš„å­˜å–é€Ÿåº¦ç›¸å·®çº¦20å€ï¼Œå› æ­¤åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨nonatomicã€‚</p>]]></content>
      
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> åŸºç¡€çŸ¥è¯† </tag>
            
            <tag> atomic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>assign VS weak? __weak VS __block?</title>
      <link href="/assign-VS-weak-block-VS-weak.html"/>
      <url>/assign-VS-weak-block-VS-weak.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p>å°çŸ¥è¯†ç‚¹ã€‚</p></div><a id="more"></a><h1 id="assign"><a href="#assign" class="headerlink" title="assign"></a>assign</h1><p><strong>assign</strong> ç”¨äºåŸºç¡€ç±»å‹çš„èµ‹å€¼ï¼Œä¸æ”¹å˜å±æ€§çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚ï¼š<em>NSInteger, CGFloat, int float double</em></p><blockquote><p>assignå…¶å®ä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°å¯¹è±¡ï¼Œä½†æ˜¯ä½ å¯ä¸è¦è½»æ˜“å°è¯•ã€‚å› ä¸ºè¢«assignä¿®é¥°çš„å¯¹è±¡åœ¨é‡Šæ”¾ä¹‹åï¼ŒæŒ‡é’ˆçš„åœ°å€è¿˜æ˜¯å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«ç½®ä¸ºnilã€‚å¦‚æœåœ¨åç»­çš„å†…å­˜åˆ†é…ä¸­ï¼Œåˆšå¥½åˆ†åˆ°äº†è¿™å—åœ°å€ï¼Œç¨‹åºå°±ä¼šå´©æºƒæ‰ã€‚</p></blockquote><h1 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h1><p><strong>weak</strong> ç”¨äºå¯¹è±¡ç±»å‹ï¼Œä¸æ”¹å˜å±æ€§çš„å¼•ç”¨è®¡æ•°ï¼Œå½“è¯¥å¯¹è±¡è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œè¯¥å¼±å¼•ç”¨çš„å±æ€§è‡ªåŠ¨å¤±æ•ˆå¹¶ä¸”è¢«èµ‹å€¼ä¸º<strong><em>nil</em></strong>ï¼Œè¯¥å±æ€§å¯ä»¥é¿å…å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p><h1 id="weak-1"><a href="#weak-1" class="headerlink" title="__weak"></a>__weak</h1><p><strong>__weak</strong>æ˜¯æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œè¢«ä¿®é¥°çš„å˜é‡åœ¨ä½¿ç”¨ç»“æŸåä¼šè¢«é‡Šæ”¾ ç½®nilï¼Œå…¶ä¹Ÿä¸ä¼šåœ¨blockä»£ç å—ä¸­è¢«retainã€‚<br>æ‰€æœ‰æƒä¿®é¥°ç¬¦åŒ…æ‹¬: __strong,  __weak,  unsafe_unretained,  __autorealeaseã€‚</p><blockquote><p>ä½¿ç”¨<strong>unsafe_unretained å’Œ __weakéƒ½å¯ä»¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä½†ç”±äºå‰è€…æ˜¯åœ¨iOS4.0ä»¥å‰</strong>weakçš„æ›¿ä»£å“ï¼Œä¸ä¼šè¢«è‡ªåŠ¨ç½®nilï¼Œä¼šé€ æˆé‡æŒ‡é’ˆé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æœæ–­æŠ›å¼ƒå§</p></blockquote><h1 id="block"><a href="#block" class="headerlink" title="__block"></a>__block</h1><p><strong>__block</strong>ç”¨äºæŒ‡æ˜å½“å‰å˜é‡å¯ä»¥åœ¨blockå†…éƒ¨è¿›è¡Œä¿®æ”¹ï¼ˆARCä¸‹ä¼šè¢«retainï¼‰ã€‚</p><blockquote><p>å› ä¸ºåœ¨blockç”³æ˜çš„åŒæ—¶ä¼šæ•è·è¯¥blockæ‰€ä½¿ç”¨çš„å…¨éƒ¨è‡ªåŠ¨å˜é‡çš„å€¼ï¼Œä»…æœ‰ä½¿ç”¨æƒæ²¡æœ‰ä¿®æ”¹æƒåˆ©ï¼Œä½¿ç”¨äº†__blockå…³é”®å­—ä¿®é¥°åçš„å˜é‡å¯ä»¥åœ¨blockå†…éƒ¨è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote><p>åœ¨blockå†…ï¼Œè¦é¿å…å¾ªç¯å¼•ç”¨è¦ä½¿ç”¨ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__weak__typeof(<span class="keyword">self</span>)weakSelf =<span class="keyword">self</span>;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ï¼Œåœ¨ä½¿ç”¨åˆ°selfä¹‹åçš„å¯¹è±¡æˆ–è€…å±æ€§é˜²æ­¢åœ¨ä½¿ç”¨ä¹‹å‰è¢«ææ„å¼•å‘ä¸å¯é¢„æµ‹çš„é—®é¢˜ï¼Œæ‰€ä»¥è¦ä½¿ç”¨strongå†æŠŠå®ƒæŒæœ‰ä¸€ä¸‹ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__strong__typeof(weakSelf)strongSelf = weakSelf;</span><br></pre></td></tr></table></figure><h2 id="æ˜“æ··æ·†ç‚¹"><a href="#æ˜“æ··æ·†ç‚¹" class="headerlink" title="æ˜“æ··æ·†ç‚¹"></a>æ˜“æ··æ·†ç‚¹</h2><p>è‹¥ object æœ¬èº«æ²’æœ‰å» retain è¿™ä¸ª block (å³blockä¸æ˜¯æŸä¸ªå¯¹è±¡çš„property)ï¼Œå‰‡å¯ä»¥ç›´æ¥åœ¨ block ä¸­ä½¿ç”¨ selfã€‚<br>æ¯”å¦‚è‡ªå®šä¹‰çš„blockå—ï¼ˆä¸€ä¸ªåŒ¿åå‡½æ•°ï¼‰åœ¨ä»£ç ä¸­æ‰§è¡Œï¼›ç»å¸¸é—®åˆ°çš„animationåŠ¨ç”»æ˜¯å¦éœ€è¦ä½¿ç”¨weakblockçš„é—®é¢˜ã€‚</p><div class="note default">äº‹å®ä¸Šå¤§å¤šæ•¸çš„ iOS åŸç”Ÿå¥—ä»¶ï¼Œä»¥åŠ GCD çš„ block æ˜¯ä¸æœƒé€ æˆ retain cycle çš„ï¼Œå› ä¸ºä»–ä»¬å¹¶æ²’æœ‰å» retain blockã€‚</div><p>ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼Œè®²ä¸€ä¸ªå˜é‡ç›´æ¥å®šä¹‰ä¸ºå®ä¾‹å˜é‡è€Œéå±æ€§çš„æ—¶å€™ï¼Œåœ¨blockä¸­ä½¿ç”¨æ—¶è¿˜æ˜¯ä¼šretainåˆ°selfå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œå› ä¸ºivarä¹Ÿæ˜¯selfçš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XXXViewController</span> () </span>&#123;</span><br><span class="line">Â  Â  <span class="built_in">NSString</span> *str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">self</span>.completionHandler = ^&#123;</span><br><span class="line">Â  Â  <span class="comment">// ç›´æ¥å¼•ç”¨å°±ç›¸å½“äº self-&gt;str</span></span><br><span class="line">Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼ivaræ˜¯æ— æ³•ç”¨weakSelfå»å–å€¼çš„ï¼Œå› æ­¤<br>è¿™é‡Œæ­£ç¡®çš„åšæ³•è¿˜æ˜¯è¦ç”¨åˆ°weakSelfå’ŒstrongSelfçš„å¸®åŠ©ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__<span class="keyword">weak</span> __<span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line"><span class="keyword">self</span>.completionHandler = ^&#123;</span><br><span class="line">Â  Â  __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakSelf) strongSelf = weakSelf;</span><br><span class="line">Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, strongSelf-&gt;str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> åŸºç¡€çŸ¥è¯† </tag>
            
            <tag> ä¿®é¥°ç¬¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSå†…å­˜ç®¡ç†åŸç†æµ…è°ˆ</title>
      <link href="/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88.html"/>
      <url>/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%8E%9F%E7%90%86%E6%B5%85%E8%B0%88.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://s2.ax1x.com/2019/07/07/ZB8apF.jpg" alt="ZB8apF.jpg"></p><a id="more"></a><p><em>2011 å¹´ï¼Œè‹¹æœåœ¨ WWDC å¤§ä¼šä¸Šæå‡ºäº†è‡ªåŠ¨çš„å¼•ç”¨è®¡æ•°ï¼ˆARCï¼‰ã€‚<br>ARC èƒŒåçš„åŸç†æ˜¯ä¾èµ–ç¼–è¯‘å™¨çš„é™æ€åˆ†æèƒ½åŠ›ï¼Œé€šè¿‡åœ¨ç¼–è¯‘æ—¶æ‰¾å‡ºåˆç†çš„ä½ç½®ï¼Œè‡ªåŠ¨æ’å…¥å¼•ç”¨è®¡æ•°ç®¡ç†ä»£ç ï¼Œä»è€Œå½»åº•è§£æ”¾è¢«å†…å­˜ç®¡ç†ç¦é”¢çš„<del>ç å†œ</del>iOSå¼€å‘è€…ã€‚</em></p><h2 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å¼•ç”¨è®¡æ•°ï¼ˆReference Countï¼‰æ˜¯ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼ã€‚</p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†å…¶å¼•ç”¨è®¡æ•°åŠ  1ï¼Œå½“æŸä¸ªæŒ‡é’ˆä¸å†æŒ‡å‘è¿™ä¸ªå¯¹è±¡æ˜¯ï¼Œæˆ‘ä»¬å°†å…¶å¼•ç”¨è®¡æ•°å‡ 1ï¼Œå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º 0 æ—¶ï¼Œè¯´æ˜è¿™ä¸ªå¯¹è±¡ä¸å†è¢«ä»»ä½•æŒ‡é’ˆæŒ‡å‘äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å°†å¯¹è±¡é”€æ¯ï¼Œå›æ”¶å†…å­˜ã€‚</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB8r01.jpg" alt="ZB8r01.jpg"></p><h3 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h3><p>åœ¨æ²¡æœ‰å¼•ç”¨è®¡æ•°çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬å†…å­˜ç®¡ç†çš„åŸåˆ™æ˜¯ â€œè°ç”³è¯·è°é‡Šæ”¾â€ï¼Œä½†æ˜¯å½“å¤šä¸ªå¯¹è±¡éœ€è¦å¼•ç”¨åˆ°æŸä¸€ä¸ªXå¯¹è±¡/å˜é‡æ—¶ï¼Œå“ªäº›å¯¹è±¡éœ€è¦é•¿æ—¶é—´ä½¿ç”¨Xå¯¹è±¡ï¼Œéƒ½ä¼šé‡åˆ°è°æ¥é”€æ¯Xå¯¹è±¡çš„é—®é¢˜ã€‚<br>å¼•ç”¨è®¡æ•°çš„å‡ºç°ï¼Œä½¿å¾—å¯¹è±¡åœ¨è¢«åˆ›å»ºå’Œä½¿ç”¨æ—¶<em>retain count</em> +1ï¼Œä½¿ç”¨å®Œå-1ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±å¯ä»¥äº¤ç»™å¼•ç”¨è®¡æ•°æ¥è®°å½•ã€‚</p><h3 id="ä¸è¦å‘å·²ç»é‡Šæ”¾çš„å¯¹è±¡å‘é€æ¶ˆæ¯"><a href="#ä¸è¦å‘å·²ç»é‡Šæ”¾çš„å¯¹è±¡å‘é€æ¶ˆæ¯" class="headerlink" title="ä¸è¦å‘å·²ç»é‡Šæ”¾çš„å¯¹è±¡å‘é€æ¶ˆæ¯"></a>ä¸è¦å‘å·²ç»é‡Šæ”¾çš„å¯¹è±¡å‘é€æ¶ˆæ¯</h3><p>å½“æŸä¸ªå¯¹è±¡çš„å†…å­˜å·²ç»è¢«å›æ”¶ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¯¹ä»–ç½®ç©º(nil)ï¼Œä»ç„¶å‘å®ƒå‘é€æ¶ˆæ¯æ—¶ï¼Œå¦‚æœè¯¥å†…å­˜è¢«å¤ç”¨äº†ï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆç¨‹åºå¼‚å¸¸å´©æºƒï¼Œä¹Ÿè¢«ç§°ä¸ºåƒµå°¸å¯¹è±¡æˆ–è€…é‡æŒ‡é’ˆå¼‚å¸¸ã€‚</p><h2 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h2><p>ARC èƒ½è§£å†³ iOS å¼€å‘ä¸­ â€œæå¤§éƒ¨åˆ†â€ çš„å†…å­˜ç®¡ç†é—®é¢˜ï¼Œä½†æ˜¯å¼€å‘è€…ä»ç„¶éœ€è¦æ³¨æ„ï¼š</p><ul><li>iOS åº•å±‚çš„ ** Core Foundation å¯¹è±¡ ** ä¸åœ¨ ARC çš„ç®¡ç†ä¸‹ï¼Œéœ€è¦æ‰‹å·¥ç®¡ç†å®ƒä»¬çš„å¼•ç”¨è®¡æ•°ã€‚</li><li>é¿å…å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</li><li>blockåŠdelegateçš„å†…å­˜ç®¡ç†ã€‚</li></ul><h3 id="å¾ªç¯å¼•ç”¨"><a href="#å¾ªç¯å¼•ç”¨" class="headerlink" title="å¾ªç¯å¼•ç”¨"></a>å¾ªç¯å¼•ç”¨</h3><p>å¼•ç”¨è®¡æ•°è¿™ç§ç®¡ç†å†…å­˜çš„æ–¹å¼æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç‘•ç–µï¼Œå³ä¸èƒ½å¾ˆå¥½çš„è§£å†³å¾ªç¯å¼•ç”¨ï¼ˆReference Cycleï¼‰é—®é¢˜ã€‚</p><p>å¯¹è±¡ A å’Œå¯¹è±¡ Bï¼Œç›¸äº’å¼•ç”¨äº†å¯¹æ–¹ä½œä¸ºè‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œåªæœ‰å½“è‡ªå·±é”€æ¯æ—¶ï¼Œæ‰ä¼šå°†æˆå‘˜å˜é‡çš„å¼•ç”¨è®¡æ•°å‡ 1ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡çš„é”€æ¯ä¾èµ–äºå¯¹æ–¹çš„é”€æ¯ï¼Œå³ä½¿åœ¨å¤–ç•Œå·²ç»æ²¡æœ‰ä»»ä½•æŒ‡é’ˆèƒ½å¤Ÿè®¿é—®åˆ°å®ƒä»¬äº†ï¼Œå®ƒä»¬ä¹Ÿæ— æ³•è¢«é‡Šæ”¾ã€‚</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB8w6J.jpg" alt="ZB8w6J.jpg"></p><p>å¤šä¸ªå¯¹è±¡ä¾æ¬¡æŒæœ‰å¯¹æ–¹ï¼Œå½¢å¼ä¸€ä¸ªç¯çŠ¶ï¼Œä¹Ÿå¯ä»¥é€ æˆå¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œè€Œä¸”åœ¨çœŸå®ç¼–ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™ç§æƒ…å†µæ›´éš¾è¢«å‘ç°ã€‚</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB80X9.png" alt="ZB80X9.png"></p><h4 id="ä¸»åŠ¨æ–­å¼€"><a href="#ä¸»åŠ¨æ–­å¼€" class="headerlink" title="ä¸»åŠ¨æ–­å¼€"></a>ä¸»åŠ¨æ–­å¼€</h4><p>å¦‚æœç¨‹åºå‘˜æ˜ç¡®çŸ¥é“è¿™é‡Œä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œåœ¨åˆç†çš„ä½ç½®ä¸»åŠ¨æ–­å¼€ç¯ä¸­çš„ä¸€ä¸ªå¼•ç”¨ï¼Œä½¿å¾—å¯¹è±¡å¾—ä»¥å›æ”¶ã€‚ä¾‹å¦‚å¦‚ä¸‹ä¸€ä¸ªå¼•ç”¨é“¾ï¼š</p><ol><li>Controller æŒæœ‰äº†ç½‘ç»œè¯·æ±‚å¯¹è±¡</li><li>ç½‘ç»œè¯·æ±‚å¯¹è±¡æŒæœ‰äº†å›è°ƒçš„ block</li><li>å›è°ƒçš„ block é‡Œé¢ä½¿ç”¨äº† selfï¼ˆå³æŒæœ‰äº† Controllerï¼‰</li></ol><p>è§£å†³åŠæ³•å°±æ˜¯ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ç»“æŸï¼Œç½‘ç»œè¯·æ±‚å¯¹è±¡æ‰§è¡Œå®Œ block ä¹‹åï¼Œä¸»åŠ¨é‡Šæ”¾å¯¹äº block çš„æŒæœ‰ï¼Œä»¥ä¾¿æ‰“ç ´å¾ªç¯å¼•ç”¨ã€‚ï¼ˆxxx.Block = nilï¼‰</p><h4 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h4><p>å¼±å¼•ç”¨è™½ç„¶æŒæœ‰å¯¹è±¡ï¼Œä½†æ˜¯å¹¶ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œè¿™æ ·å°±é¿å…äº†å¾ªç¯å¼•ç”¨çš„äº§ç”Ÿã€‚</p><p>åœ¨ iOS å¼€å‘ä¸­ï¼Œå¼±å¼•ç”¨é€šå¸¸åœ¨ delegate æ¨¡å¼ä¸­ä½¿ç”¨ï¼ŒView Controller çš„ delegate æˆå‘˜å˜é‡é€šå¸¸æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä»¥é¿å…ä¸¤ä¸ª ViewController é€ æˆå¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¾‹å¦‚tableViewçš„delegateã€‚</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB8dl4.png" alt="ZB8dl4.png"></p><h5 id="å¼±å¼•ç”¨çš„å®ç°åŸç†"><a href="#å¼±å¼•ç”¨çš„å®ç°åŸç†" class="headerlink" title="å¼±å¼•ç”¨çš„å®ç°åŸç†"></a>å¼±å¼•ç”¨çš„å®ç°åŸç†</h5><p>ç³»ç»Ÿå¯¹äºæ¯ä¸€ä¸ªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œéƒ½ç»´æŠ¤ä¸€ä¸ªè¡¨æ¥è®°å½•å®ƒæ‰€æœ‰çš„å¼±å¼•ç”¨çš„æŒ‡é’ˆåœ°å€ã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œç³»ç»Ÿå°±é€šè¿‡è¿™å¼ è¡¨ï¼Œæ‰¾åˆ°æ‰€æœ‰çš„å¼±å¼•ç”¨æŒ‡é’ˆï¼Œç»§è€ŒæŠŠå®ƒä»¬éƒ½ç½®æˆ nilã€‚</p><p>ä»åŸç†æˆ‘ä»¬å¾—çŸ¥ï¼Œå¼±å¼•ç”¨çš„ä½¿ç”¨æ˜¯æœ‰<strong>é¢å¤–å¼€é”€</strong>çš„ã€‚è™½ç„¶è¿™ä¸ªå¼€é”€å¾ˆå°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªåœ°æ–¹æˆ‘ä»¬è‚¯å®šå®ƒä¸éœ€è¦å¼±å¼•ç”¨çš„ç‰¹æ€§ï¼Œå°±ä¸åº”è¯¥ç›²ç›®ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå› ä¸ºï¼š</p><ul><li>å½“æˆ‘ä»¬åœ¨åˆ›å»ºè¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸´æ—¶ä½¿ç”¨ä¸€ä¸ªå¼±å¼•ç”¨æŒæœ‰å®ƒï¼Œå°±ä¼šå› ä¸º weak å˜é‡å¹¶ä¸æŒæœ‰å¯¹è±¡ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªå¯¹è±¡åˆšè¢«åˆ›å»ºå°±é”€æ¯æ‰ã€‚</li><li>å¤§éƒ¨åˆ† ViewController çš„è§†å›¾å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸ ViewController æœ¬èº«æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰å¿…è¦é¢å¤–åšè¿™ä¸ªäº‹æƒ…ã€‚</li></ul><h2 id="Xcode-æ£€æµ‹å¾ªç¯å¼•ç”¨"><a href="#Xcode-æ£€æµ‹å¾ªç¯å¼•ç”¨" class="headerlink" title="Xcode æ£€æµ‹å¾ªç¯å¼•ç”¨"></a>Xcode æ£€æµ‹å¾ªç¯å¼•ç”¨</h2><p>åœ¨ Xcode çš„èœå•æ é€‰æ‹©ï¼šProduct -&gt; Profileï¼Œç„¶åé€‰æ‹© â€œLeaksâ€ï¼Œå†ç‚¹å‡»å³ä¸‹è§’çš„â€Profileâ€ æŒ‰é’®å¼€å§‹æ£€æµ‹ã€‚</p><p>æˆ‘ä»¬åœ¨æ¨¡æ‹Ÿå™¨é‡Œè¿›è¡Œä¸€äº›ç•Œé¢çš„åˆ‡æ¢ã€‚å¦‚æœå‡ºç°äº†å†…å­˜æ³„æ¼ï¼Œå°±å¯ä»¥åœ¨ Instruments ä¸­çœ‹åˆ°çº¢è‰²çš„å¸¦â€xâ€çš„å›¾æ ‡å†™ç€â€œn new leaksâ€..</p><p>ç‚¹å‡» â€œLeaks Checksâ€ æ ï¼Œå†ç‚¹å‡»â€Cycles &amp; Rootsâ€ï¼Œå°±å¯ä»¥çœ‹åˆ°ä»¥å›¾å½¢æ–¹å¼æ˜¾ç¤ºå‡ºæ¥çš„å¾ªç¯å¼•ç”¨ã€‚å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°æ‰¾åˆ°å¾ªç¯å¼•ç”¨çš„å¯¹è±¡äº†ã€‚å¦‚å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2019/07/07/ZB8NfU.png" alt="ZB8NfU.png"></p>]]></content>
      
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> åŸºç¡€çŸ¥è¯† </tag>
            
            <tag> ARC </tag>
            
            <tag> å†…å­˜ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>â€œgit add .â€ not worked - â€œè¯¡å¼‚â€é—®é¢˜è§£å†³</title>
      <link href="/%E2%80%9Cgit-add-%E2%80%9D-not-worked-%E2%80%9C%E8%AF%A1%E5%BC%82%E2%80%9D%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3.html"/>
      <url>/%E2%80%9Cgit-add-%E2%80%9D-not-worked-%E2%80%9C%E8%AF%A1%E5%BC%82%E2%80%9D%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3.html</url>
      
        <content type="html"><![CDATA[<div class="note warning"><p>å¬ç»ˆç«¯çš„è¯ï¼Œåˆ«ç•™ä¸‹warningã€‚</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">"fuckit"</span></span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">  (commit or discard the untracked or modified content <span class="keyword">in</span> submodules)</span><br><span class="line"></span><br><span class="line">modified:   xxx/themes/next (modified content, untracked content)</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><hr><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>è‡ªä»æŠŠåšå®¢æºç æ‰˜ç®¡åˆ°githubä»“åº“ä¹‹åï¼Œè…°ä¹Ÿä¸é…¸äº†ï¼Œè…¿ä¹Ÿä¸ç—›äº†ï¼Œä¸€å£æ°”ä¸Šäº”æ¥¼..å’³å’³</p><p>ä¹‹åæˆ‘ç»™hexoæ¢äº†ä¸€ä¸ªNEXTä¸»é¢˜ï¼Œçˆ½ç‚¸äº†ï¼å¯æ˜¯ä»Šå¤©ä¿®æ”¹äº†ä¸»é¢˜æŸä¸ªjsæ–‡ä»¶ï¼Œ<br>â€œ<strong>git status</strong>â€ä¹‹åå´æ˜¾ç¤º<em>â€œnothing to commitâ€</em> ???</p><p>ä¸Šgithubä¸Šçœ‹æºç ä»“åº“ï¼Œå´å‘ç°ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹ç©ºç©ºå¦‚ä¹Ÿ..ä»“åº“å´æ˜¾ç¤ºæ²¡é—®é¢˜ï¼Œ<strong>git log</strong>ï¼Œä¸€ç›´åœç•™åœ¨ä¸Šä¸ªæäº¤ç‰ˆæœ¬ã€‚</p><p>äºæ˜¯ä¸€ç›´æ­»å¾ªç¯æ“ä½œâ€œ<strong>git add .</strong>â€&amp;&amp;â€œ<strong>git commit -m â€œxxxâ€</strong>â€ï¼Œ<br>ç»ˆç«¯å´ä¸€ç›´æ— æƒ…å›å¤æˆ‘â€œChanges not staged for commitâ€ï¼Œå¦‚ä¸Šé¢é‚£æ®µä»£ç æ‰€ç¤ºã€‚</p><p>å°è¯•æŒ‰ç…§ç»ˆç«¯æç¤ºçš„åŠæ³•æ— æ³•è§£å†³ã€‚</p><p>è¿™å°±å¾ˆè¯¡å¼‚äº†ï¼Ÿäºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªæ™šä¸Šç–¯ç‹‚è¸©å‘..</p><h2 id="çˆ¬å‘"><a href="#çˆ¬å‘" class="headerlink" title="çˆ¬å‘"></a>çˆ¬å‘</h2><p>æœç´¢äº†å„ä¸ªå…³é”®è¯å¥ï¼Œçœ‹äº†stackoverflowå’Œå‡ ç¯‡æ— ç”¨åšæ–‡è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è§£å†³ã€‚<br>ç›´è§‰æ˜¯æ–‡ä»¶å¼•å…¥çš„é—®é¢˜ï¼Œä¸€å£æ°”æŠŠnextæ–‡ä»¶ â€œ<strong>git rm â€“f xxx/themes/next</strong>â€ å†addè¿›å»ï¼Œä»”ç»†ä¸€çœ‹å´å‘ç°æœ‰å¦‚ä¸‹æç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">warning: adding embedded git repository: xxx/themes/next</span><br><span class="line">hint: You<span class="string">'ve added another git repository inside your current repository.</span></span><br><span class="line"><span class="string">hint: Clones of the outer repository will not contain the contents of</span></span><br><span class="line"><span class="string">hint: the embedded repository and will not know how to obtain it.</span></span><br><span class="line"><span class="string">hint: If you meant to add a submodule, use:</span></span><br><span class="line"><span class="string">hint:</span></span><br><span class="line"><span class="string">hint: git submodule add &lt;url&gt; xxx/themes/next</span></span><br><span class="line"><span class="string">hint:</span></span><br><span class="line"><span class="string">hint: If you added this path by mistake, you can remove it from the</span></span><br><span class="line"><span class="string">hint: index with:</span></span><br><span class="line"><span class="string">hint:</span></span><br><span class="line"><span class="string">hint: git rm --cached xxx/themes/next</span></span><br><span class="line"><span class="string">hint:</span></span><br><span class="line"><span class="string">hint: See "git help submodule" for more information.</span></span><br></pre></td></tr></table></figure><p>è¿˜å¥½æˆ‘è®¤è¯†ä¸€ç‚¹è‹±æ–‡ï¼Œæƒ³èµ·å½“æ—¶æ˜¯ä»gitä»“åº“ç›´æ¥å…‹éš†nextçš„ï¼Œå´å› ä¸ºç²—å¿ƒæ²¡æœ‰çœ‹warningï¼Œå¾„ç›´commitäº†ï¼ˆå±…ç„¶ä¹Ÿæ²¡äº‹- -!ï¼‰ï¼Œæ‰ä¼šå¼•å‘ä»¥ä¸Šçš„æƒ¨å‰§ã€‚<br>äºæ˜¯ä¹èµ¶ç´§æŠŠä¸»é¢˜ä¸‹çš„gitä»“åº“åˆ é™¤äº†ã€‚</p><p>å·äº†ä¸ªæ‡’ï¼ŒæŠŠnextæ–‡ä»¶å¤¹ç§»èµ°ï¼Œcommitï¼Œå†ç§»è¿›æ¥ï¼Œaddä¹‹åæ€»ç®—èƒ½çœ‹åˆ°ä¸€æ’æ’çš„ä¸»é¢˜ç›¸å…³æ–‡ä»¶è¾£ï½</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>gitä»“åº“ä¸‹è¦æäº¤Aæ–‡ä»¶å¤¹ï¼ŒA/Bæ–‡ä»¶å¤¹ä¸‹ä¹ŸåŒ…å«ä¸€ä¸ªgitä»“åº“ï¼ˆ.gitï¼‰ã€‚ä½¿ç”¨<strong>git add .</strong> å°±åªèƒ½åŠ å…¥ä¸€ä¸ªç©ºçš„Bæ–‡ä»¶å¤¹ã€‚</p><hr><h4 id="è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä»¥LINUXâ€œæ²¡æœ‰å›åº”å°±æ˜¯æœ€å¥½çš„å›åº”â€çš„å°¿æ€§æ¥è¯´ï¼Œè¿˜æ˜¯å¥½å¥½çœ‹ç»ˆç«¯å›å¤å§ã€‚"><a href="#è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä»¥LINUXâ€œæ²¡æœ‰å›åº”å°±æ˜¯æœ€å¥½çš„å›åº”â€çš„å°¿æ€§æ¥è¯´ï¼Œè¿˜æ˜¯å¥½å¥½çœ‹ç»ˆç«¯å›å¤å§ã€‚" class="headerlink" title="è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä»¥LINUXâ€œæ²¡æœ‰å›åº”å°±æ˜¯æœ€å¥½çš„å›åº”â€çš„å°¿æ€§æ¥è¯´ï¼Œè¿˜æ˜¯å¥½å¥½çœ‹ç»ˆç«¯å›å¤å§ã€‚"></a>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä»¥LINUXâ€œæ²¡æœ‰å›åº”å°±æ˜¯æœ€å¥½çš„å›åº”â€çš„å°¿æ€§æ¥è¯´ï¼Œè¿˜æ˜¯å¥½å¥½çœ‹ç»ˆç«¯å›å¤å§ã€‚</h4>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
